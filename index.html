<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="theme-color" content="#0a0a0a" id="theme-meta">
<meta name="mobile-web-app-capable" content="true">
<meta name="apple-mobile-web-app-capable" content="true">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Lean Journey">
<title>LEAN JOURNEY</title>
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@400;500&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THEME VARIABLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --gold: #e8c547; --gold2: #c9a227;
  --gold-dim: rgba(232,197,71,0.12);
  --gold-glow: rgba(232,197,71,0.22);
  --red: #e05252; --green: #4caf7d; --blue: #5b8dee;
  --red-dim: rgba(224,82,82,0.12);
  --green-dim: rgba(76,175,125,0.12);
  --blue-dim: rgba(91,141,238,0.12);
  --transition: all .2s ease;
}
[data-theme="dark"] {
  --bg: #0a0a0a; --bg2: #141414; --card: #1a1a1a;
  --card2: #222; --border: #2a2a2a; --border2: #333;
  --text: #f0f0f0; --text2: #aaa; --text3: #666;
  --shadow: rgba(0,0,0,0.4);
}
[data-theme="light"] {
  --bg: #f4f4f0; --bg2: #ebebeb; --card: #ffffff;
  --card2: #f0f0ec; --border: #e0e0d8; --border2: #ccc;
  --text: #111; --text2: #555; --text3: #999;
  --shadow: rgba(0,0,0,0.1);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET & BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{width:100%;max-width:520px;margin:0 auto;height:100%;overflow:hidden;
  background:var(--bg);font-family:'DM Sans',sans-serif;color:var(--text);
  -webkit-font-smoothing:antialiased;transition:background .3s,color .3s}
input,select,textarea{font-family:'DM Sans',sans-serif}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   APP SHELL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#app{display:flex;flex-direction:column;height:100dvh;position:relative;overflow:hidden}

/* PAGES */
.page{display:none;flex-direction:column;flex:1;overflow-y:auto;overflow-x:hidden;
  padding-bottom:calc(72px + env(safe-area-inset-bottom, 0px));scrollbar-width:none}
.page::-webkit-scrollbar{display:none}
.page.active{display:flex}

/* NAV */
nav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);
  width:100%;max-width:520px;
  height:calc(60px + env(safe-area-inset-bottom, 0px));
  padding-bottom:env(safe-area-inset-bottom, 0px);
  background:var(--card);backdrop-filter:blur(20px);
  border-top:1px solid var(--border);
  display:flex;align-items:center;z-index:100}
.nav-btn{flex:1;display:flex;flex-direction:column;align-items:center;
  justify-content:center;gap:3px;height:60px;background:none;border:none;
  cursor:pointer;color:var(--text3);transition:var(--transition);position:relative}
.nav-btn.active{color:var(--gold)}
.nav-btn svg{width:20px;height:20px;stroke-width:1.8}
.nav-btn span{font-size:9px;font-weight:600;letter-spacing:.8px;text-transform:uppercase}
.nav-indicator{position:absolute;bottom:6px;width:4px;height:4px;border-radius:50%;
  background:var(--gold);opacity:0;transition:.2s}
.nav-btn.active .nav-indicator{opacity:1}

/* PAGE HEADER */
.page-header{padding:calc(14px + env(safe-area-inset-top,0px)) 20px 12px;
  display:flex;align-items:center;justify-content:space-between;flex-shrink:0;
  background:var(--bg);position:sticky;top:0;z-index:10;
  border-bottom:1px solid var(--border)}
.page-title{font-family:'Bebas Neue',cursive;font-size:28px;letter-spacing:2px;color:var(--text)}
.page-title span{color:var(--gold)}

/* SECTION LABEL */
.sec-lbl{font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;
  color:var(--text3);padding:16px 20px 8px;flex-shrink:0}

/* CARDS */
.card{background:var(--card);border-radius:16px;border:1px solid var(--border)}
.card-pad{padding:16px}

/* PILLS */
.pill{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;
  border-radius:20px;font-size:10px;font-weight:700;letter-spacing:.5px}
.pill-gold{background:var(--gold-dim);color:var(--gold)}
.pill-green{background:var(--green-dim);color:var(--green)}
.pill-red{background:var(--red-dim);color:var(--red)}
.pill-blue{background:var(--blue-dim);color:var(--blue)}

/* PROGRESS BAR */
.prog-track{height:5px;background:var(--border);border-radius:3px;overflow:hidden}
.prog-fill{height:100%;border-radius:3px;
  background:linear-gradient(90deg,var(--gold2),var(--gold));
  transition:width .6s cubic-bezier(.4,0,.2,1)}

/* DIVIDER */
.divider{height:1px;background:var(--border);margin:0 20px}

/* INPUTS */
.inp-group{padding:10px 20px}
.inp-label{font-size:10px;font-weight:700;color:var(--text3);
  text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;display:block}
.inp{width:100%;background:var(--card2);border:1.5px solid var(--border);
  border-radius:12px;padding:13px 14px;color:var(--text);font-size:15px;
  outline:none;transition:border-color .2s;-webkit-appearance:none;appearance:none}
.inp:focus{border-color:var(--gold)}
.inp::placeholder{color:var(--text3)}

/* BUTTONS */
.btn{display:flex;align-items:center;justify-content:center;gap:8px;border:none;
  border-radius:14px;cursor:pointer;font-family:'DM Sans',sans-serif;font-weight:700;
  transition:transform .12s,box-shadow .12s;letter-spacing:.3px}
.btn:active{transform:scale(.95)}
.btn-primary{background:var(--gold);color:#000;padding:15px 20px;font-size:14px;width:100%}
.btn-ghost{background:var(--card2);color:var(--text);padding:13px 16px;
  font-size:13px;border:1.5px solid var(--border)}
.btn-icon{background:var(--card2);color:var(--text);
  width:38px;height:38px;border-radius:11px;border:1px solid var(--border);
  display:flex;align-items:center;justify-content:center;flex-shrink:0;cursor:pointer}
.btn-sm{padding:8px 14px;font-size:12px;border-radius:10px}

/* SHEET */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:200;
  opacity:0;pointer-events:none;transition:opacity .25s;backdrop-filter:blur(6px)}
.overlay.open{opacity:1;pointer-events:all}
.sheet{position:fixed;bottom:0;left:50%;transform:translateX(-50%) translateY(100%);
  width:100%;max-width:520px;background:var(--bg2);border-radius:24px 24px 0 0;
  border-top:1px solid var(--border);z-index:201;
  transition:transform .32s cubic-bezier(.32,.72,0,1);
  padding-bottom:env(safe-area-inset-bottom,0px);max-height:92dvh;overflow-y:auto}
.sheet.open{transform:translateX(-50%) translateY(0)}
.sheet-handle{width:36px;height:4px;background:var(--border);
  border-radius:2px;margin:12px auto 0}
.sheet-title{font-family:'Bebas Neue',cursive;font-size:22px;letter-spacing:2px;
  padding:14px 20px 6px;color:var(--text)}
.sheet-sub{font-size:12px;color:var(--text2);padding:0 20px 10px;line-height:1.5}

/* TOAST */
#toast{position:fixed;top:calc(14px + env(safe-area-inset-top,0px));left:50%;
  transform:translateX(-50%) translateY(-80px);
  background:var(--card);border:1px solid var(--gold);
  border-radius:12px;padding:11px 18px;font-size:13px;font-weight:600;
  color:var(--text);z-index:400;transition:transform .3s cubic-bezier(.32,.72,0,1);
  white-space:nowrap;max-width:calc(100% - 40px);text-align:center;
  box-shadow:0 4px 20px var(--shadow)}
#toast.show{transform:translateX(-50%) translateY(0)}

/* ANIMATIONS */
@keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
@keyframes scaleIn{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
.fade-up{animation:fadeUp .3s ease forwards}
.scale-in{animation:scaleIn .25s ease forwards}
.blink{animation:pulse 1.5s ease-in-out infinite}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HOME PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hero{background:linear-gradient(150deg,rgba(232,197,71,.08) 0%,transparent 60%);
  padding:calc(16px + env(safe-area-inset-top,0px)) 20px 16px;
  border-bottom:1px solid var(--border);flex-shrink:0;position:relative;overflow:hidden}
.hero::after{content:'';position:absolute;top:-40px;right:-40px;width:180px;height:180px;
  background:radial-gradient(circle,var(--gold-glow),transparent 70%);pointer-events:none}
.hero-date{font-size:11px;color:var(--text3);font-weight:600;letter-spacing:.5px;margin-bottom:2px}
.hero-title{font-family:'Bebas Neue',cursive;font-size:36px;line-height:1;letter-spacing:3px}
.hero-title em{color:var(--gold);font-style:normal}
.hero-quote{font-size:11px;color:var(--text2);margin-top:10px;padding-top:10px;
  border-top:1px solid var(--border);font-style:italic;line-height:1.5}

.stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;padding:12px 20px}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:14px;
  padding:12px 10px;display:flex;flex-direction:column;gap:2px;cursor:pointer;
  transition:border-color .2s}
.stat-card:active{border-color:var(--gold)}
.stat-val{font-family:'DM Mono',monospace;font-size:20px;font-weight:500;color:var(--text)}
.stat-val em{font-size:11px;color:var(--text3);font-style:normal}
.stat-lbl{font-size:9px;color:var(--text3);text-transform:uppercase;letter-spacing:1px}

.streak-card{margin:0 20px;background:var(--card);border:1px solid var(--border);
  border-radius:16px;padding:14px 16px;display:flex;align-items:center;gap:14px}
.streak-num{font-family:'Bebas Neue',cursive;font-size:48px;line-height:1;color:var(--gold)}
.streak-dots{display:flex;gap:4px;margin-top:8px;flex-wrap:wrap}
.streak-dot{width:24px;height:5px;border-radius:3px;background:var(--border)}
.streak-dot.on{background:var(--gold)}

/* GYM SCHEDULE CARD */
.gym-card{margin:12px 20px 0;background:var(--card);border:1px solid var(--border);
  border-radius:16px;overflow:hidden}
.gym-card-hdr{padding:14px 16px;border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
  background:linear-gradient(90deg,var(--gold-dim),transparent)}
.gym-time-big{font-family:'Bebas Neue',cursive;font-size:32px;letter-spacing:2px;color:var(--gold)}
.gym-set-btn{background:var(--gold);color:#000;border:none;border-radius:10px;
  padding:8px 14px;font-size:12px;font-weight:700;cursor:pointer;letter-spacing:.3px}

/* WATER */
.water-card{margin:12px 20px 0;background:var(--card);border:1px solid var(--border);
  border-radius:16px;padding:14px 16px}
.water-cups-row{display:flex;gap:6px;margin-top:10px;flex-wrap:wrap}
.wcup{width:34px;height:42px;border-radius:0 0 7px 7px;
  border:2px solid var(--border);cursor:pointer;position:relative;
  overflow:hidden;transition:border-color .15s}
.wcup.filled{border-color:var(--blue)}
.wcup.filled::after{content:'';position:absolute;inset:0;
  background:linear-gradient(to top,var(--blue),rgba(91,141,238,.3));border-radius:0 0 5px 5px}
.wcup:active{transform:scale(.88)}

/* NOTIFICATION ALERT */
.notif-alert{margin:12px 20px 0;background:linear-gradient(135deg,rgba(232,197,71,.12),rgba(232,197,71,.05));
  border:1px solid rgba(232,197,71,.3);border-radius:16px;padding:14px 16px;
  display:flex;align-items:center;gap:12px}
.notif-icon{font-size:24px;flex-shrink:0}
.notif-text{flex:1}
.notif-title{font-size:13px;font-weight:700;color:var(--text)}
.notif-sub{font-size:11px;color:var(--text2);margin-top:2px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WORKOUT PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.day-scroll{display:flex;gap:6px;padding:12px 20px;overflow-x:auto;scrollbar-width:none;flex-shrink:0}
.day-scroll::-webkit-scrollbar{display:none}
.day-chip{display:flex;flex-direction:column;align-items:center;min-width:48px;
  padding:9px 4px;border-radius:13px;border:1.5px solid var(--border);
  background:var(--card);cursor:pointer;transition:all .2s;flex-shrink:0;position:relative}
.day-chip.selected{background:var(--gold);border-color:var(--gold)}
.day-chip.selected .d-name,.day-chip.selected .d-num{color:#000}
.day-chip.today:not(.selected){border-color:var(--gold)}
.d-name{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--text3)}
.d-num{font-family:'DM Mono',monospace;font-size:17px;font-weight:500;color:var(--text);margin-top:1px}
.d-done-dot{width:5px;height:5px;border-radius:50%;background:var(--green);
  position:absolute;top:5px;right:5px;opacity:0}
.day-chip.logged .d-done-dot{opacity:1}

/* WORKOUT SESSION HEADER */
.session-hdr{margin:0 20px;background:var(--card);border:1px solid var(--border);
  border-radius:16px;overflow:hidden}
.sesh-top{padding:14px 16px;border-bottom:1px solid var(--border);
  background:linear-gradient(90deg,var(--gold-dim),transparent);
  display:flex;align-items:center;justify-content:space-between}
.sesh-name{font-family:'Bebas Neue',cursive;font-size:22px;letter-spacing:1.5px;color:var(--text)}
.sesh-prog-row{padding:12px 16px;display:flex;align-items:center;gap:10px}
.sesh-prog-lbl{font-size:11px;color:var(--text3);flex-shrink:0}
.sesh-prog-val{font-family:'DM Mono',monospace;font-size:11px;color:var(--gold);flex-shrink:0}

/* EXERCISE ROW â€” PRO */
.ex-list{margin:10px 20px;display:flex;flex-direction:column;gap:8px}
.ex-card{background:var(--card);border:1.5px solid var(--border);
  border-radius:14px;overflow:hidden;transition:border-color .2s}
.ex-card.active-ex{border-color:var(--gold)}
.ex-card.done-ex{border-color:var(--green);opacity:.75}
.ex-header{display:flex;align-items:center;gap:10px;padding:13px 14px;cursor:pointer}
.ex-num-badge{width:30px;height:30px;border-radius:9px;background:var(--gold-dim);
  color:var(--gold);font-family:'DM Mono',monospace;font-size:12px;font-weight:500;
  display:flex;align-items:center;justify-content:center;flex-shrink:0}
.ex-num-badge.done{background:var(--green-dim);color:var(--green)}
.ex-name-wrap{flex:1;min-width:0}
.ex-name{font-size:13px;font-weight:600;color:var(--text)}
.ex-plan{font-size:11px;color:var(--text3);margin-top:2px}
.ex-chevron{color:var(--text3);transition:transform .2s;flex-shrink:0}
.ex-card.expanded .ex-chevron{transform:rotate(180deg)}

/* SET LOGGER */
.set-logger{border-top:1px solid var(--border);padding:12px 14px;
  background:var(--card2);display:none}
.ex-card.expanded .set-logger{display:block}
.suggest-box{background:var(--gold-dim);border:1px solid rgba(232,197,71,.25);
  border-radius:10px;padding:10px 12px;margin-bottom:10px}
.suggest-title{font-size:10px;font-weight:700;color:var(--gold);
  text-transform:uppercase;letter-spacing:1px;margin-bottom:4px}
.suggest-txt{font-size:12px;color:var(--text);line-height:1.5}

.set-inputs-row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;margin-bottom:8px}
.set-inp-wrap{display:flex;flex-direction:column;gap:4px}
.set-inp-lbl{font-size:9px;font-weight:700;color:var(--text3);
  text-transform:uppercase;letter-spacing:.8px}
.set-inp{background:var(--card);border:1.5px solid var(--border);
  border-radius:9px;padding:9px 8px;color:var(--text);font-size:15px;
  font-family:'DM Mono',monospace;text-align:center;outline:none;width:100%;
  transition:border-color .2s;-webkit-appearance:none}
.set-inp:focus{border-color:var(--gold)}

.sets-logged{display:flex;flex-direction:column;gap:4px;margin-bottom:8px}
.set-row-logged{display:flex;align-items:center;gap:8px;padding:6px 10px;
  background:var(--card);border-radius:8px;border:1px solid var(--border)}
.set-row-lbl{font-family:'DM Mono',monospace;font-size:11px;color:var(--text3);flex-shrink:0}
.set-row-vals{font-size:12px;color:var(--text);flex:1}
.set-row-del{color:var(--text3);font-size:14px;cursor:pointer;padding:2px 4px}

.set-btn-row{display:flex;gap:6px}
.log-set-btn{flex:1;background:var(--gold);color:#000;border:none;border-radius:10px;
  padding:11px;font-family:'DM Sans',sans-serif;font-weight:700;font-size:13px;cursor:pointer}
.log-set-btn:active{transform:scale(.96)}
.done-ex-btn{background:var(--green-dim);color:var(--green);border:1.5px solid var(--green);
  border-radius:10px;padding:11px 14px;font-family:'DM Sans',sans-serif;font-weight:700;
  font-size:12px;cursor:pointer;white-space:nowrap}

/* REST TIMER INLINE */
.rest-timer-bar{display:none;align-items:center;gap:10px;padding:10px 14px;
  border-top:1px solid var(--border);background:rgba(91,141,238,.08)}
.ex-card.resting .rest-timer-bar{display:flex}
.rest-timer-disp{font-family:'Bebas Neue',cursive;font-size:28px;color:var(--blue);letter-spacing:2px}
.rest-timer-lbl{font-size:11px;color:var(--text2);flex:1}
.rest-skip-btn{font-size:11px;color:var(--blue);font-weight:700;cursor:pointer;
  background:none;border:none;padding:4px 8px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CALORIES PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cal-summary{margin:0 20px;background:var(--card);border:1px solid var(--border);
  border-radius:18px;padding:18px;display:flex;align-items:center;gap:16px}
.cal-text-side{flex:1}
.cal-remain-lbl{font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:1px}
.cal-remain-num{font-family:'Bebas Neue',cursive;font-size:52px;line-height:1;color:var(--text)}
.cal-remain-num em{font-size:18px;color:var(--text3);font-style:normal}
.cal-eaten-row{font-size:11px;color:var(--text2);margin-top:4px}

/* RING */
.ring-wrap{position:relative;width:88px;height:88px;flex-shrink:0}
.ring-wrap svg{transform:rotate(-90deg)}
.ring-text{position:absolute;inset:0;display:flex;flex-direction:column;
  align-items:center;justify-content:center}
.ring-pct{font-family:'DM Mono',monospace;font-size:16px;font-weight:500;color:var(--text)}
.ring-sub{font-size:8px;color:var(--text3);text-transform:uppercase;letter-spacing:.5px}

.macro-bars{padding:10px 20px;display:flex;flex-direction:column;gap:7px}
.macro-row{display:flex;align-items:center;gap:8px}
.macro-lbl{font-size:9px;font-weight:700;color:var(--text3);
  text-transform:uppercase;letter-spacing:.8px;width:52px}
.macro-val{font-family:'DM Mono',monospace;font-size:10px;color:var(--text);width:52px;text-align:right}

/* CALORIE BURN SECTION */
.burn-card{margin:0 20px;background:var(--card);border:1px solid var(--border);
  border-radius:14px;padding:14px 16px;display:flex;align-items:center;gap:12px}
.burn-icon{font-size:28px}
.burn-info{flex:1}
.burn-title{font-size:13px;font-weight:600;color:var(--text)}
.burn-sub{font-size:11px;color:var(--text2);margin-top:2px}
.burn-num{font-family:'Bebas Neue',cursive;font-size:28px;color:var(--red)}

/* QUICK FOOD GRID */
.qfood-grid{display:grid;grid-template-columns:1fr 1fr;gap:7px;padding:0 20px}
.qfood{background:var(--card);border:1px solid var(--border);border-radius:13px;
  padding:12px;display:flex;align-items:center;gap:8px;cursor:pointer;transition:all .15s}
.qfood:active{transform:scale(.96);border-color:var(--gold)}
.qfood-em{font-size:20px;flex-shrink:0}
.qfood-name{font-size:11px;font-weight:600;color:var(--text)}
.qfood-kcal{font-size:10px;color:var(--gold);margin-top:1px}

/* FOOD LOG LIST */
.food-log-list{padding:0 20px;display:flex;flex-direction:column;gap:6px}
.food-item{background:var(--card);border:1px solid var(--border);border-radius:12px;
  padding:11px 14px;display:flex;align-items:center;gap:10px}
.food-em{font-size:22px;flex-shrink:0}
.food-info{flex:1;min-width:0}
.food-name{font-size:12px;font-weight:600;color:var(--text);
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.food-macros{font-size:10px;color:var(--text3);margin-top:1px}
.food-kcal{font-family:'DM Mono',monospace;font-size:13px;color:var(--gold);flex-shrink:0}
.food-del{color:var(--text3);cursor:pointer;padding:4px;flex-shrink:0}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REPORTS PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.report-tabs{display:flex;background:var(--card2);border-radius:12px;
  padding:3px;margin:0 20px}
.r-tab{flex:1;padding:8px 4px;border-radius:9px;border:none;font-family:'DM Sans',sans-serif;
  font-size:11px;font-weight:700;color:var(--text3);background:none;cursor:pointer;transition:all .2s}
.r-tab.active{background:var(--gold);color:#000}

.report-kpi-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;padding:0 20px}
.kpi-card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px}
.kpi-val{font-family:'Bebas Neue',cursive;font-size:32px;line-height:1;color:var(--text)}
.kpi-val em{font-size:14px;color:var(--text3);font-style:normal}
.kpi-lbl{font-size:9px;color:var(--text3);text-transform:uppercase;letter-spacing:1px;margin-top:3px}
.kpi-change{font-size:10px;font-weight:700;margin-top:5px}
.kpi-change.good{color:var(--green)} .kpi-change.bad{color:var(--red)}

/* SVG CHART */
.chart-card{margin:0 20px;background:var(--card);border:1px solid var(--border);
  border-radius:16px;padding:16px;overflow:hidden}
.chart-title{font-size:11px;font-weight:700;color:var(--text3);
  text-transform:uppercase;letter-spacing:1px;margin-bottom:14px}
.chart-svg{width:100%;overflow:visible}

/* EXERCISE PROGRESS */
.ex-prog-list{padding:0 20px;display:flex;flex-direction:column;gap:8px}
.ex-prog-card{background:var(--card);border:1px solid var(--border);border-radius:13px;padding:13px}
.ex-prog-name{font-size:13px;font-weight:600;color:var(--text);margin-bottom:6px}
.ex-prog-nums{display:flex;justify-content:space-between;margin-bottom:5px}
.ex-prog-start{font-size:11px;color:var(--text3)}
.ex-prog-now{font-family:'DM Mono',monospace;font-size:13px;color:var(--gold);font-weight:500}

/* NET DEFICIT CARD */
.deficit-card{margin:0 20px;border-radius:16px;padding:16px;
  background:linear-gradient(135deg,rgba(76,175,125,.15),rgba(76,175,125,.05));
  border:1px solid rgba(76,175,125,.3)}
.deficit-title{font-size:11px;font-weight:700;color:var(--green);
  text-transform:uppercase;letter-spacing:1px;margin-bottom:6px}
.deficit-num{font-family:'Bebas Neue',cursive;font-size:48px;color:var(--green);line-height:1}
.deficit-num em{font-size:18px;color:var(--text3);font-style:normal}
.deficit-breakdown{display:flex;gap:16px;margin-top:8px;padding-top:8px;border-top:1px solid rgba(76,175,125,.2)}
.deficit-item{flex:1;text-align:center}
.deficit-item-val{font-family:'DM Mono',monospace;font-size:14px;font-weight:500;color:var(--text)}
.deficit-item-lbl{font-size:9px;color:var(--text3);text-transform:uppercase;letter-spacing:.8px;margin-top:2px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BODY / SETTINGS PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.body-metrics-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;padding:0 20px}
.bm-card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;cursor:pointer}
.bm-val{font-family:'Bebas Neue',cursive;font-size:34px;line-height:1;color:var(--text)}
.bm-val em{font-size:15px;color:var(--text3);font-style:normal}
.bm-lbl{font-size:9px;color:var(--text3);text-transform:uppercase;letter-spacing:1px;margin-top:2px}
.bm-chg{font-size:10px;font-weight:700;margin-top:4px}

.settings-list{padding:0 20px;display:flex;flex-direction:column;gap:6px}
.setting-row{background:var(--card);border:1px solid var(--border);border-radius:13px;
  padding:14px 16px;display:flex;align-items:center;gap:12px;cursor:pointer;transition:border-color .15s}
.setting-row:active{border-color:var(--gold)}
.setting-icon{font-size:20px;width:34px;text-align:center}
.setting-info{flex:1}
.setting-title{font-size:13px;font-weight:600;color:var(--text)}
.setting-sub{font-size:11px;color:var(--text3);margin-top:1px}
.setting-right{color:var(--text3)}

/* PHASE CHIP SELECTOR */
.phase-chip{background:var(--card);border:1.5px solid var(--border);border-radius:12px;
  padding:13px 14px;cursor:pointer;transition:all .2s}
.phase-chip.selected{border-color:var(--gold);background:var(--gold-dim)}
.phase-chip-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:4px}
.phase-chip-name{font-size:13px;font-weight:700;color:var(--text)}
.phase-chip-months{font-size:10px;color:var(--text3);font-weight:600}
.phase-chip-stats{display:flex;gap:8px;flex-wrap:wrap}
.phase-chip-stat{font-size:10px;color:var(--text2)}

/* ROADMAP ROWS */
.roadmap-row{display:flex;gap:10px;padding:10px 14px;border-bottom:1px solid var(--border)}
.roadmap-row:last-child{border-bottom:none}
.roadmap-phase-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0;margin-top:3px}
.roadmap-phase-info{flex:1;min-width:0}
.roadmap-phase-name{font-size:12px;font-weight:700;color:var(--text)}
.roadmap-phase-months{font-size:10px;color:var(--text3);margin-bottom:2px}
.roadmap-phase-targets{font-size:11px;color:var(--text2);line-height:1.5}

/* TARGET PREVIEW CARD */
.target-preview{background:var(--card2);border:1px solid var(--border);border-radius:14px;margin:0 20px;overflow:hidden}
.target-preview-hdr{padding:12px 14px;border-bottom:1px solid var(--border);
  background:linear-gradient(90deg,var(--gold-dim),transparent);
  display:flex;align-items:center;justify-content:space-between}
.target-preview-title{font-family:'Bebas Neue',cursive;font-size:18px;letter-spacing:1.5px;color:var(--text)}
.target-preview-badge{font-size:9px;font-weight:700;color:var(--gold);letter-spacing:1px;text-transform:uppercase}
.target-grid{display:grid;grid-template-columns:1fr 1fr;gap:0}
.target-cell{padding:10px 14px;border-right:1px solid var(--border);border-bottom:1px solid var(--border)}
.target-cell:nth-child(even){border-right:none}
.target-cell:nth-last-child(-n+2){border-bottom:none}
.target-cell-lbl{font-size:9px;color:var(--text3);text-transform:uppercase;letter-spacing:.8px;font-weight:700}
.target-cell-val{font-family:'DM Mono',monospace;font-size:14px;color:var(--text);margin-top:2px;font-weight:500}
.target-cell-val em{font-size:10px;color:var(--text3);font-style:normal}

/* TOGGLE SWITCH */
.toggle-sw{position:relative;width:44px;height:26px;flex-shrink:0}
.toggle-sw input{opacity:0;width:0;height:0}
.toggle-track{position:absolute;inset:0;background:var(--border);border-radius:13px;
  cursor:pointer;transition:.3s}
.toggle-track::before{content:'';position:absolute;height:20px;width:20px;left:3px;bottom:3px;
  background:#fff;border-radius:50%;transition:.3s}
input:checked + .toggle-track{background:var(--gold)}
input:checked + .toggle-track::before{transform:translateX(18px)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WORKOUT ACTIVE SESSION (full-screen overlay)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#active-session{position:fixed;inset:0;background:var(--bg);z-index:300;
  display:none;flex-direction:column;max-width:520px;margin:0 auto}
#active-session.open{display:flex}
.as-header{padding:calc(16px + env(safe-area-inset-top,0px)) 20px 12px;
  display:flex;align-items:center;gap:12px;border-bottom:1px solid var(--border);flex-shrink:0}
.as-close{background:var(--card2);border:1px solid var(--border);border-radius:10px;
  width:36px;height:36px;display:flex;align-items:center;justify-content:center;
  cursor:pointer;flex-shrink:0}
.as-title-wrap{flex:1}
.as-session-name{font-family:'Bebas Neue',cursive;font-size:20px;letter-spacing:1.5px;color:var(--text)}
.as-ex-count{font-size:11px;color:var(--text3)}
.as-body{flex:1;overflow-y:auto;padding:16px 20px;display:flex;flex-direction:column;gap:14px}
.as-progress-row{display:flex;align-items:center;gap:10px;flex-shrink:0;padding:0 20px 8px}

/* ACTIVE EXERCISE CARD */
.aex-card{background:var(--card);border:1.5px solid var(--gold);border-radius:18px;overflow:hidden}
.aex-hdr{padding:14px 16px;border-bottom:1px solid var(--border);
  background:linear-gradient(90deg,var(--gold-dim),transparent)}
.aex-num{font-size:10px;font-weight:700;color:var(--gold);text-transform:uppercase;letter-spacing:1.5px}
.aex-name{font-family:'Bebas Neue',cursive;font-size:24px;letter-spacing:1px;color:var(--text);margin-top:2px}
.aex-plan-detail{font-size:11px;color:var(--text3);margin-top:2px}

/* SUGGEST PANEL */
.aex-suggest{margin:14px 16px;background:var(--gold-dim);border:1px solid rgba(232,197,71,.25);
  border-radius:12px;padding:12px 14px}
.aex-suggest-title{font-size:10px;font-weight:700;color:var(--gold);
  text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;display:flex;align-items:center;gap:6px}
.aex-suggest-body{font-size:12px;color:var(--text);line-height:1.6}

/* SET INPUT AREA */
.aex-set-area{padding:0 16px 14px}
.aex-set-title{font-size:11px;font-weight:700;color:var(--text3);
  text-transform:uppercase;letter-spacing:1px;margin-bottom:10px}
.aex-inputs{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:12px}
.aex-inp-wrap{display:flex;flex-direction:column;gap:5px}
.aex-inp-lbl{font-size:9px;font-weight:700;color:var(--text3);
  text-transform:uppercase;letter-spacing:.8px;text-align:center}
.aex-inp{background:var(--card2);border:1.5px solid var(--border);
  border-radius:10px;padding:12px 8px;color:var(--text);font-size:20px;
  font-family:'DM Mono',monospace;text-align:center;outline:none;width:100%;
  transition:border-color .2s;-webkit-appearance:none;font-weight:500}
.aex-inp:focus{border-color:var(--gold)}

/* SETS LOGGED MINI LIST */
.aex-sets-done{padding:0 16px;display:flex;flex-direction:column;gap:5px;margin-bottom:10px}
.aex-set-logged{display:flex;align-items:center;gap:8px;padding:7px 10px;
  background:var(--card2);border-radius:9px;border:1px solid var(--border)}
.aex-set-lbl{font-family:'DM Mono',monospace;font-size:10px;color:var(--text3);width:40px}
.aex-set-vals{font-size:12px;color:var(--text);flex:1}
.aex-set-del{color:var(--text3);cursor:pointer;font-size:16px;padding:0 4px}

/* LOG SET BUTTON */
.aex-log-btn{margin:0 16px 10px;background:var(--gold);color:#000;border:none;
  border-radius:12px;padding:14px;font-family:'DM Sans',sans-serif;font-weight:700;
  font-size:14px;cursor:pointer;width:calc(100% - 32px);letter-spacing:.3px}
.aex-log-btn:active{transform:scale(.97)}

/* REST TIMER FULL */
.rest-overlay{position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:400;
  display:none;flex-direction:column;align-items:center;justify-content:center;
  max-width:520px;margin:0 auto;backdrop-filter:blur(8px)}
.rest-overlay.open{display:flex}
.rest-title{font-size:12px;font-weight:700;color:var(--text3);
  text-transform:uppercase;letter-spacing:2px;margin-bottom:8px}
.rest-big{font-family:'Bebas Neue',cursive;font-size:96px;letter-spacing:4px;
  color:var(--blue);line-height:1;margin-bottom:4px}
.rest-next{font-size:13px;color:var(--text2);margin-bottom:32px;text-align:center;padding:0 40px}
.rest-skip{background:var(--card2);color:var(--text);border:1px solid var(--border);
  border-radius:14px;padding:14px 40px;font-family:'DM Sans',sans-serif;font-weight:700;
  font-size:14px;cursor:pointer}

/* DONE BUTTON */
.aex-done-btn{margin:0 16px 16px;background:var(--green-dim);color:var(--green);
  border:1.5px solid var(--green);border-radius:12px;padding:13px;
  font-family:'DM Sans',sans-serif;font-weight:700;font-size:13px;cursor:pointer;
  width:calc(100% - 32px)}
.aex-done-btn:active{transform:scale(.97)}

.as-footer{padding:12px 20px;padding-bottom:calc(12px + env(safe-area-inset-bottom,0px));
  border-top:1px solid var(--border);display:flex;gap:8px;flex-shrink:0}

/* SESSION COMPLETE */
.session-complete{position:fixed;inset:0;background:var(--bg);z-index:500;
  display:none;flex-direction:column;align-items:center;justify-content:center;
  padding:40px 24px;max-width:520px;margin:0 auto}
.session-complete.open{display:flex}
.sc-icon{font-size:64px;margin-bottom:16px}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE â€” TABLET & DESKTOP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (min-width:520px){
  html,body{max-width:520px}
  .stats-grid{grid-template-columns:repeat(3,1fr)}
  .page-title{font-size:32px}
  .hero-title{font-size:42px}
  .stat-val{font-size:22px}
}
@media (max-width:360px){
  .stats-grid{grid-template-columns:repeat(3,1fr)}
  .stat-val{font-size:17px}
  .wcup{width:28px;height:36px}
  .streak-num{font-size:40px}
  .gym-time-big{font-size:26px}
  .page-title{font-size:24px}
}
@media (max-width:320px){
  .hero-title{font-size:30px}
  .set-inputs-row,.aex-inputs{grid-template-columns:1fr 1fr 1fr}
  .aex-inp{font-size:16px;padding:9px 4px}
}

/* MILESTONE CARDS */
.milestone-card{background:var(--card);border:1px solid var(--border);border-radius:14px;
  padding:14px 16px;cursor:pointer;transition:border-color .2s;position:relative;overflow:hidden}
.milestone-card:active{border-color:var(--gold)}
.milestone-card.current-phase{border-color:var(--gold)}
.milestone-card.achieved{border-color:var(--green)}
.milestone-card.future{opacity:.65}
.milestone-badge{position:absolute;top:12px;right:12px;font-size:10px;font-weight:700;
  letter-spacing:.5px;padding:3px 8px;border-radius:20px}
.milestone-badge.achieved{background:var(--green-dim);color:var(--green)}
.milestone-badge.current{background:var(--gold-dim);color:var(--gold)}
.milestone-badge.future{background:var(--card2);color:var(--text3)}
.milestone-period{font-size:10px;font-weight:700;color:var(--text3);text-transform:uppercase;
  letter-spacing:1.2px;margin-bottom:4px}
.milestone-title{font-family:'Bebas Neue',cursive;font-size:20px;letter-spacing:1.5px;color:var(--text);margin-bottom:8px}
.milestone-stats-row{display:flex;gap:8px;flex-wrap:wrap}
.milestone-stat{display:flex;flex-direction:column;gap:2px;min-width:60px}
.milestone-stat-val{font-family:'DM Mono',monospace;font-size:13px;font-weight:500;color:var(--text)}
.milestone-stat-lbl{font-size:9px;color:var(--text3);text-transform:uppercase;letter-spacing:.8px}

/* PHASE TARGET CARD */
.phase-target-card{background:linear-gradient(135deg,rgba(232,197,71,.1),rgba(232,197,71,.03));
  border:1px solid rgba(232,197,71,.3);border-radius:16px;padding:16px}
.phase-target-title{font-family:'Bebas Neue',cursive;font-size:22px;letter-spacing:2px;
  color:var(--gold);margin-bottom:4px}
.phase-target-sub{font-size:11px;color:var(--text2);margin-bottom:14px;line-height:1.5}
.phase-targets-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.phase-target-item{background:rgba(0,0,0,.2);border-radius:10px;padding:10px 12px}
.phase-target-item-val{font-family:'DM Mono',monospace;font-size:14px;font-weight:500;color:var(--text)}
.phase-target-item-lbl{font-size:9px;color:var(--text3);text-transform:uppercase;letter-spacing:.8px;margin-top:2px}

/* PHASE OPTION CARDS in sheet */
.phase-option-card{background:var(--card);border:1.5px solid var(--border);border-radius:13px;
  padding:14px 16px;cursor:pointer;transition:all .2s}
.phase-option-card:active,.phase-option-card.selected{border-color:var(--gold);background:var(--gold-dim)}
.phase-option-year{font-size:10px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:1px;margin-bottom:3px}
.phase-option-name{font-size:14px;font-weight:700;color:var(--text)}
.phase-option-months{font-size:11px;color:var(--text2);margin-top:2px}

  color:var(--gold);text-align:center;margin-bottom:8px}
.sc-stats{display:grid;grid-template-columns:1fr 1fr;gap:10px;width:100%;margin:20px 0}
.sc-stat{background:var(--card);border:1px solid var(--border);border-radius:14px;
  padding:14px;text-align:center}
.sc-stat-val{font-family:'Bebas Neue',cursive;font-size:32px;color:var(--gold)}
.sc-stat-lbl{font-size:9px;color:var(--text3);text-transform:uppercase;letter-spacing:1px}
</style>
</head>
<body>
<div id="app">

<!-- â•â•â•â•â•â•â•â•â•â• HOME â•â•â•â•â•â•â•â•â•â• -->
<div class="page active" id="page-home">
  <div class="hero">
    <div class="hero-date" id="hero-date"></div>
    <div class="hero-title">LET'S<br><em id="hero-word">BUILD.</em></div>
    <div class="hero-quote" id="hero-quote"></div>
  </div>

  <div class="stats-grid">
    <div class="stat-card"><div class="stat-val" id="h-weight">â€”<em>kg</em></div><div class="stat-lbl">Weight</div></div>
    <div class="stat-card"><div class="stat-val" id="h-streak">0<em>d</em></div><div class="stat-lbl">Streak</div></div>
    <div class="stat-card"><div class="stat-val" id="h-cal">â€”<em>c</em></div><div class="stat-lbl">Eaten</div></div>
  </div>

  <div class="streak-card">
    <div class="streak-num" id="streak-big">0</div>
    <div style="flex:1">
      <div style="font-size:13px;font-weight:700;color:var(--text)">Day Streak ğŸ”¥</div>
      <div style="font-size:11px;color:var(--text3);margin-top:2px">Never miss twice</div>
      <div class="streak-dots" id="streak-dots"></div>
    </div>
  </div>

  <!-- GYM TIME CARD -->
  <div class="sec-lbl">GYM SCHEDULE</div>
  <div class="gym-card">
    <div class="gym-card-hdr">
      <div>
        <div style="font-size:10px;color:var(--text3);font-weight:700;letter-spacing:1px;text-transform:uppercase">Today's Gym Time</div>
        <div class="gym-time-big" id="gym-time-display">Not Set</div>
        <div style="font-size:11px;color:var(--text2)" id="preworkout-info"></div>
      </div>
      <button class="gym-set-btn" id="set-gym-time-btn">SET TIME</button>
    </div>
    <div style="padding:12px 16px" id="gym-countdown-wrap">
      <div style="font-size:11px;color:var(--text3);margin-bottom:6px">Time Until Gym</div>
      <div style="font-family:'Bebas Neue',cursive;font-size:24px;color:var(--text)" id="gym-countdown">â€”</div>
    </div>
  </div>

  <!-- NOTIFICATIONS BANNER -->
  <div class="notif-alert" id="notif-banner" style="display:none">
    <div class="notif-icon">â°</div>
    <div class="notif-text">
      <div class="notif-title" id="notif-title">Pre-Workout Time!</div>
      <div class="notif-sub" id="notif-sub">Take your pre-workout now â€” gym in 45 min</div>
    </div>
  </div>

  <!-- WATER -->
  <div class="sec-lbl">HYDRATION â€” 3.5L DAILY</div>
  <div class="water-card">
    <div style="display:flex;align-items:center;justify-content:space-between">
      <div>
        <div style="font-size:13px;font-weight:600;color:var(--text)">Water Intake</div>
        <div style="font-size:11px;color:var(--text3);margin-top:2px">Each cup = 500ml Â· Target 7 cups</div>
      </div>
      <div style="font-family:'DM Mono',monospace;font-size:22px;color:var(--blue)" id="water-ml">0.0L</div>
    </div>
    <div class="water-cups-row" id="water-cups"></div>
  </div>
  <div style="height:12px"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• WORKOUT â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-workout">
  <div class="page-header">
    <div class="page-title">WORK<span>OUT</span></div>
    <div style="display:flex;gap:8px">
      <button class="btn-icon" id="start-session-btn" title="Start Active Session">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>
      </button>
    </div>
  </div>

  <div class="day-scroll" id="day-scroll"></div>

  <div class="sec-lbl" id="workout-day-lbl">SUNDAY â€” UPPER STRENGTH</div>
  <div class="session-hdr">
    <div class="sesh-top">
      <div>
        <div class="sesh-name" id="sesh-name">UPPER STRENGTH</div>
        <div style="font-size:11px;color:var(--text3);margin-top:2px" id="sesh-meta">Chest + Back Â· ~55 min</div>
      </div>
      <div class="pill pill-gold" id="sesh-tag">Day 1</div>
    </div>
    <div class="sesh-prog-row">
      <div class="sesh-prog-lbl">Progress</div>
      <div style="flex:1" class="prog-track"><div class="prog-fill" id="sesh-prog-bar" style="width:0%"></div></div>
      <div class="sesh-prog-val" id="sesh-prog-val">0/0</div>
    </div>
  </div>

  <div class="ex-list" id="ex-list"></div>
  <div style="height:12px"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• CALORIES â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-cal">
  <div class="page-header">
    <div class="page-title">CALO<span>RIES</span></div>
    <div style="font-size:11px;color:var(--text3)" id="cal-date-lbl"></div>
  </div>

  <div class="cal-summary">
    <div class="cal-text-side">
      <div class="cal-remain-lbl">Remaining</div>
      <div class="cal-remain-num"><span id="cal-remain">2200</span><em>kcal</em></div>
      <div class="cal-eaten-row">Eaten: <span id="cal-eaten">0</span> Â· Burned: <span id="cal-burned-txt" style="color:var(--red)">0</span></div>
    </div>
    <div class="ring-wrap">
      <svg width="88" height="88" viewBox="0 0 88 88">
        <circle cx="44" cy="44" r="36" fill="none" stroke="var(--border)" stroke-width="7"/>
        <circle id="ring-arc" cx="44" cy="44" r="36" fill="none" stroke="var(--gold)"
          stroke-width="7" stroke-linecap="round"
          stroke-dasharray="226" stroke-dashoffset="226"
          style="transition:stroke-dashoffset .6s ease"/>
      </svg>
      <div class="ring-text">
        <div class="ring-pct" id="ring-pct">0%</div>
        <div class="ring-sub">eaten</div>
      </div>
    </div>
  </div>

  <div class="macro-bars">
    <div class="macro-row">
      <div class="macro-lbl">Protein</div>
      <div style="flex:1" class="prog-track"><div class="prog-fill" id="bar-p" style="width:0%;background:linear-gradient(90deg,#5b8dee,#7ab5ff)"></div></div>
      <div class="macro-val"><span id="val-p">0</span>/<span id="tgt-p">140</span>g</div>
    </div>
    <div class="macro-row">
      <div class="macro-lbl">Carbs</div>
      <div style="flex:1" class="prog-track"><div class="prog-fill" id="bar-c" style="width:0%"></div></div>
      <div class="macro-val"><span id="val-c">0</span>/<span id="tgt-c">240</span>g</div>
    </div>
    <div class="macro-row">
      <div class="macro-lbl">Fat</div>
      <div style="flex:1" class="prog-track"><div class="prog-fill" id="bar-f" style="width:0%;background:linear-gradient(90deg,#e05252,#ff8a8a)"></div></div>
      <div class="macro-val"><span id="val-f">0</span>/<span id="tgt-f">60</span>g</div>
    </div>
  </div>

  <div style="margin:0 20px 0">
    <div class="burn-card">
      <div class="burn-icon">ğŸ”¥</div>
      <div class="burn-info">
        <div class="burn-title">Calories Burned Today</div>
        <div class="burn-sub" id="burn-source">From workout + NEAT</div>
      </div>
      <div class="burn-num" id="burn-display">0</div>
    </div>
  </div>

  <div class="sec-lbl">QUICK ADD</div>
  <div class="qfood-grid" id="qfood-grid"></div>

  <div class="sec-lbl">TODAY'S LOG</div>
  <div class="food-log-list" id="food-log-list">
    <div style="color:var(--text3);font-size:13px;text-align:center;padding:20px">No food logged yet</div>
  </div>
  <div style="height:12px"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• REPORTS â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-reports">
  <div class="page-header">
    <div class="page-title">RE<span>PORTS</span></div>
  </div>

  <div style="padding:12px 20px">
    <div class="report-tabs" id="report-tabs">
      <button class="r-tab active" data-period="week">Week</button>
      <button class="r-tab" data-period="month">Month</button>
      <button class="r-tab" data-period="quarter">Quarter</button>
      <button class="r-tab" data-period="year">Year</button>
    </div>
  </div>

  <!-- NET DEFICIT -->
  <div class="deficit-card">
    <div class="deficit-title">âš¡ Net Calorie Deficit</div>
    <div class="deficit-num"><span id="deficit-num">0</span><em>kcal</em></div>
    <div style="font-size:11px;color:var(--text3);margin-top:4px" id="deficit-sub">Keep going â€” deficit = fat loss</div>
    <div class="deficit-breakdown">
      <div class="deficit-item">
        <div class="deficit-item-val" id="r-consumed">0</div>
        <div class="deficit-item-lbl">Consumed</div>
      </div>
      <div class="deficit-item">
        <div class="deficit-item-val" id="r-burned">0</div>
        <div class="deficit-item-lbl">Burned</div>
      </div>
      <div class="deficit-item">
        <div class="deficit-item-val" id="r-bmr">0</div>
        <div class="deficit-item-lbl">BMR Total</div>
      </div>
    </div>
  </div>

  <div class="sec-lbl">KEY METRICS</div>
  <div class="report-kpi-grid" id="report-kpis"></div>

  <div class="sec-lbl">WEIGHT TREND</div>
  <div class="chart-card">
    <div class="chart-title" id="weight-chart-title">WEIGHT â€” This Week</div>
    <svg class="chart-svg" id="weight-chart" viewBox="0 0 340 100" width="100%" height="100" preserveAspectRatio="none"></svg>
  </div>

  <div class="sec-lbl">STRENGTH PROGRESSION</div>
  <div class="ex-prog-list" id="ex-prog-list"></div>

  <div class="sec-lbl">BODY TRENDS</div>
  <div class="chart-card">
    <div class="chart-title">WAIST &amp; RESTING HR</div>
    <svg class="chart-svg" id="body-chart" viewBox="0 0 340 100" width="100%" height="100" preserveAspectRatio="none"></svg>
  </div>
  <div style="height:12px"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• PROFILE â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-profile">
  <div class="page-header">
    <div class="page-title">PRO<span>FILE</span></div>
  </div>

  <div class="sec-lbl">BODY STATS</div>
  <div class="body-metrics-grid" id="body-metrics"></div>

  <div style="padding:10px 20px">
    <button class="btn btn-primary" id="log-body-btn">+ LOG TODAY'S STATS</button>
  </div>

  <div class="sec-lbl">PUSH-UP TRACKER</div>
  <div style="padding:0 20px">
    <div class="card card-pad" style="display:flex;align-items:center;gap:12px">
      <div style="flex:1">
        <div style="font-size:13px;font-weight:600;color:var(--text)">Today's Push-Ups</div>
        <div style="font-size:11px;color:var(--text3);margin-top:2px">Track every upper body session</div>
      </div>
      <div style="font-family:'Bebas Neue',cursive;font-size:40px;color:var(--gold)" id="pushup-val">0</div>
      <div style="display:flex;flex-direction:column;gap:5px">
        <button class="btn-icon" id="pu-up"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="18 15 12 9 6 15"/></svg></button>
        <button class="btn-icon" id="pu-dn"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg></button>
      </div>
    </div>
  </div>

  <div class="sec-lbl">SETTINGS</div>
  <div class="settings-list">
    <div class="setting-row" id="theme-toggle-row">
      <div class="setting-icon">ğŸŒ™</div>
      <div class="setting-info">
        <div class="setting-title">Dark Mode</div>
        <div class="setting-sub">Toggle light / dark theme</div>
      </div>
      <label class="toggle-sw"><input type="checkbox" id="theme-toggle" checked><div class="toggle-track"></div></label>
    </div>
    <div class="setting-row" id="notif-perm-row">
      <div class="setting-icon">ğŸ””</div>
      <div class="setting-info">
        <div class="setting-title">Enable Notifications</div>
        <div class="setting-sub" id="notif-status">Tap to allow reminders</div>
      </div>
      <label class="toggle-sw"><input type="checkbox" id="notif-toggle"><div class="toggle-track"></div></label>
    </div>
    <div class="setting-row" id="cal-target-row">
      <div class="setting-icon">âš–ï¸</div>
      <div class="setting-info">
        <div class="setting-title">Calorie Targets</div>
        <div class="setting-sub" id="cal-target-sub">2,200 kcal Â· P:140g C:240g F:60g</div>
      </div>
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="setting-right"><polyline points="9 18 15 12 9 6"/></svg>
    </div>
    <div class="setting-row" id="plan-phase-row">
      <div class="setting-icon">ğŸ“…</div>
      <div class="setting-info">
        <div class="setting-title">Current Plan Phase</div>
        <div class="setting-sub" id="plan-phase-sub">Year 1 Â· Month 1â€“3 Â· Foundation</div>
      </div>
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="setting-right"><polyline points="9 18 15 12 9 6"/></svg>
    </div>
    <div class="setting-row" id="view-targets-row">
      <div class="setting-icon">ğŸ—ºï¸</div>
      <div class="setting-info">
        <div class="setting-title">View Future Phase Targets</div>
        <div class="setting-sub">Browse nutrition &amp; body targets for all 8 phases</div>
      </div>
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="setting-right"><polyline points="9 18 15 12 9 6"/></svg>
    </div>
  </div>

  <div class="sec-lbl">2-YEAR ROADMAP</div>
  <div id="roadmap-preview" style="margin:0 20px">
    <div class="card" style="overflow:hidden" id="roadmap-card">
      <!-- rendered by JS -->
    </div>
  </div>

  <div class="sec-lbl">YEAR 1 PROGRESS</div>
  <div style="padding:0 20px">
    <div class="card card-pad">
      <div style="display:flex;justify-content:space-between;margin-bottom:8px">
        <div style="font-size:13px;font-weight:600;color:var(--text)">Weight Loss</div>
        <div style="font-size:11px;color:var(--text3)" id="prog-w-lbl">92 â†’ 72 kg</div>
      </div>
      <div class="prog-track"><div class="prog-fill" id="prog-w" style="width:0%"></div></div>
      <div style="display:flex;justify-content:space-between;margin:10px 0 6px">
        <div style="font-size:13px;font-weight:600;color:var(--text)">Waist</div>
        <div style="font-size:11px;color:var(--text3)">38 â†’ 30 in</div>
      </div>
      <div class="prog-track"><div class="prog-fill" id="prog-ws" style="width:0%"></div></div>
    </div>
  </div>

  <div class="sec-lbl">CURRENT PHASE TARGETS</div>
  <div style="padding:0 20px" id="phase-targets-card">
    <!-- rendered by JS -->
  </div>

  <div class="sec-lbl">MILESTONES</div>
  <div style="padding:0 20px;display:flex;flex-direction:column;gap:8px;padding-bottom:4px" id="milestones-list">
    <!-- rendered by JS -->
  </div>
  <div style="height:12px"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• NAV â•â•â•â•â•â•â•â•â•â• -->
<nav>
  <button class="nav-btn active" data-page="home">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
    <span>Home</span><div class="nav-indicator"></div>
  </button>
  <button class="nav-btn" data-page="workout">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M6.5 6.5h11M6.5 17.5h11M2 12h4m12 0h4"/><circle cx="6" cy="12" r="2"/><circle cx="18" cy="12" r="2"/></svg>
    <span>Workout</span><div class="nav-indicator"></div>
  </button>
  <button class="nav-btn" data-page="cal">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 2a9 9 0 100 18A9 9 0 0012 2z"/><path d="M8.5 14s1.5 2 3.5 2 3.5-2 3.5-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>
    <span>Calories</span><div class="nav-indicator"></div>
  </button>
  <button class="nav-btn" data-page="reports">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
    <span>Reports</span><div class="nav-indicator"></div>
  </button>
  <button class="nav-btn" data-page="profile">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
    <span>Profile</span><div class="nav-indicator"></div>
  </button>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â• OVERLAYS â•â•â•â•â•â•â•â•â•â• -->
<div class="overlay" id="overlay"></div>

<!-- GYM TIME SHEET -->
<div class="sheet" id="gym-sheet">
  <div class="sheet-handle"></div>
  <div class="sheet-title">SET GYM TIME</div>
  <div class="sheet-sub">Your trainer will remind you to drink water, eat pre-workout, and warm up at the right times.</div>
  <div class="inp-group">
    <label class="inp-label">Gym Time Today</label>
    <input type="time" class="inp" id="gym-time-inp">
  </div>
  <div class="inp-group" style="padding-top:0">
    <label class="inp-label">Pre-Workout Lead Time</label>
    <select class="inp" id="preworkout-lead">
      <option value="30">30 minutes before</option>
      <option value="45" selected>45 minutes before</option>
      <option value="60">60 minutes before</option>
    </select>
  </div>
  <div class="inp-group"><button class="btn btn-primary" id="gym-time-save">SAVE GYM TIME</button></div>
</div>

<!-- FOOD ADD SHEET -->
<div class="sheet" id="food-sheet">
  <div class="sheet-handle"></div>
  <div class="sheet-title">ADD FOOD</div>
  <div class="inp-group">
    <label class="inp-label">Food Name</label>
    <input type="text" class="inp" id="f-name" placeholder="e.g. 4 Boiled Eggs">
  </div>
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:0">
    <div class="inp-group"><label class="inp-label">Calories</label><input type="number" class="inp" id="f-kcal" placeholder="280" inputmode="numeric"></div>
    <div class="inp-group"><label class="inp-label">Protein (g)</label><input type="number" class="inp" id="f-p" placeholder="24" inputmode="numeric"></div>
    <div class="inp-group"><label class="inp-label">Carbs (g)</label><input type="number" class="inp" id="f-c" placeholder="0" inputmode="numeric"></div>
    <div class="inp-group"><label class="inp-label">Fat (g)</label><input type="number" class="inp" id="f-f" placeholder="20" inputmode="numeric"></div>
  </div>
  <div class="inp-group"><button class="btn btn-primary" id="food-save">SAVE FOOD</button></div>
</div>

<!-- BODY LOG SHEET -->
<div class="sheet" id="body-sheet">
  <div class="sheet-handle"></div>
  <div class="sheet-title">LOG STATS</div>
  <div class="inp-group"><label class="inp-label">Weight (kg)</label><input type="number" class="inp" id="bl-w" placeholder="92" inputmode="decimal"></div>
  <div class="inp-group"><label class="inp-label">Waist (inches)</label><input type="number" class="inp" id="bl-ws" placeholder="38" inputmode="decimal"></div>
  <div class="inp-group"><label class="inp-label">Resting HR (bpm)</label><input type="number" class="inp" id="bl-rhr" placeholder="80" inputmode="numeric"></div>
  <div class="inp-group"><label class="inp-label">Sleep (hours)</label><input type="number" class="inp" id="bl-sl" placeholder="7" inputmode="decimal"></div>
  <div class="inp-group"><button class="btn btn-primary" id="body-save">SAVE STATS</button></div>
</div>

<!-- PLAN PHASE SHEET -->
<div class="sheet" id="phase-sheet">
  <div class="sheet-handle"></div>
  <div class="sheet-title">CURRENT PHASE</div>
  <div class="sheet-sub">Select your current plan phase â€” calorie targets update automatically.</div>
  <div style="padding:0 20px 20px;display:flex;flex-direction:column;gap:8px" id="phase-options">
    <!-- rendered by JS -->
  </div>
</div>

<!-- VIEW FUTURE TARGETS SHEET -->
<div class="sheet" id="targets-sheet">
  <div class="sheet-handle"></div>
  <div class="sheet-title">PHASE <span style="color:var(--gold)">TARGETS</span></div>
  <div class="sheet-sub">Select any phase to preview its nutrition &amp; body targets.</div>
  <div style="padding:0 20px 10px">
    <select class="inp" id="target-phase-select">
      <!-- rendered by JS -->
    </select>
  </div>
  <div id="target-phase-preview" style="padding:0 20px 24px">
    <!-- rendered by JS -->
  </div>
</div>

<!-- CALORIE TARGET SHEET -->
<div class="sheet" id="cal-target-sheet">
  <div class="sheet-handle"></div>
  <div class="sheet-title">CALORIE TARGETS</div>
  <div class="sheet-sub">Choose a preset from your plan or enter custom values.</div>

  <div class="inp-group">
    <label class="inp-label">Preset (by bodyweight)</label>
    <select class="inp" id="cal-preset-select">
      <option value="">â€” Select Preset â€”</option>
      <option value="2200|140|240|60">90â€“92 kg Â· 2,200 kcal Â· P:140g C:240g F:60g</option>
      <option value="2100|140|228|58">85â€“89 kg Â· 2,100 kcal Â· P:140g C:228g F:58g</option>
      <option value="2000|140|218|55">80â€“84 kg Â· 2,000 kcal Â· P:140g C:218g F:55g</option>
      <option value="1900|140|205|52">75â€“79 kg Â· 1,900 kcal Â· P:140g C:205g F:52g</option>
      <option value="1850|140|198|50">72â€“74 kg Â· 1,850 kcal Â· P:140g C:198g F:50g (Y1 Target)</option>
      <option value="1950|155|200|55">Y2 Recomp Â· 1,950 kcal Â· P:155g C:200g F:55g</option>
      <option value="2050|160|212|58">Y2 Lean Gain Â· 2,050 kcal Â· P:160g C:212g F:58g</option>
      <option value="1950|160|200|55">Y2 Elite Lean Â· 1,950 kcal Â· P:160g C:200g F:55g</option>
      <option value="2000|165|205|57">Y2 Mastery Â· 2,000 kcal Â· P:165g C:205g F:57g</option>
      <option value="custom">Customâ€¦</option>
    </select>
  </div>

  <div id="cal-custom-fields" style="display:none">
    <div class="inp-group"><label class="inp-label">Calories (kcal)</label><input type="number" class="inp" id="ct-kcal" placeholder="2200" inputmode="numeric"></div>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;padding:0 20px">
      <div><label class="inp-label" style="font-size:9px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:1px;display:block;margin-bottom:6px">Protein (g)</label><input type="number" class="inp" id="ct-p" placeholder="140" inputmode="numeric"></div>
      <div><label class="inp-label" style="font-size:9px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:1px;display:block;margin-bottom:6px">Carbs (g)</label><input type="number" class="inp" id="ct-c" placeholder="240" inputmode="numeric"></div>
      <div><label class="inp-label" style="font-size:9px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:1px;display:block;margin-bottom:6px">Fat (g)</label><input type="number" class="inp" id="ct-f" placeholder="60" inputmode="numeric"></div>
    </div>
  </div>

  <div class="inp-group" style="margin-top:8px"><button class="btn btn-primary" id="cal-target-save">SAVE TARGETS</button></div>
</div>

<!-- BURN CONFIRM SHEET -->
<div class="sheet" id="burn-sheet">
  <div class="sheet-handle"></div>
  <div class="sheet-title">CALORIES BURNED</div>
  <div class="sheet-sub" id="burn-sheet-sub">Based on your session type and weight, we estimate you burned:</div>
  <div style="text-align:center;padding:16px 20px">
    <div style="font-family:'Bebas Neue',cursive;font-size:64px;color:var(--red)" id="burn-estimate">0</div>
    <div style="font-size:13px;color:var(--text3)">kcal estimated</div>
  </div>
  <div class="inp-group"><label class="inp-label">Adjust if needed</label><input type="number" class="inp" id="burn-adjust" inputmode="numeric"></div>
  <div class="inp-group"><button class="btn btn-primary" id="burn-confirm">CONFIRM BURN</button></div>
</div>

</div><!-- /app -->

<!-- â•â•â•â•â•â•â•â•â•â• ACTIVE SESSION OVERLAY â•â•â•â•â•â•â•â•â•â• -->
<div id="active-session">
  <div class="as-header">
    <div class="as-close" id="as-close">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
    </div>
    <div class="as-title-wrap">
      <div class="as-session-name" id="as-session-name">UPPER STRENGTH</div>
      <div class="as-ex-count" id="as-ex-count">Exercise 1 of 8</div>
    </div>
    <div style="font-family:'DM Mono',monospace;font-size:13px;color:var(--text3)" id="as-timer">00:00</div>
  </div>

  <div class="as-progress-row">
    <div style="flex:1" class="prog-track"><div class="prog-fill" id="as-prog-bar" style="width:0%"></div></div>
    <div style="font-family:'DM Mono',monospace;font-size:11px;color:var(--gold);flex-shrink:0;margin-left:8px" id="as-prog-val">0%</div>
  </div>

  <div class="as-body" id="as-body">
    <!-- Active exercise card rendered here -->
  </div>

  <div class="as-footer">
    <button class="btn btn-ghost" style="flex:1" id="as-prev-btn">â† PREV</button>
    <button class="btn btn-primary" style="flex:2" id="as-next-btn">NEXT â†’</button>
  </div>
</div>

<!-- REST TIMER OVERLAY -->
<div class="rest-overlay" id="rest-overlay">
  <div class="rest-title">REST PERIOD</div>
  <div class="rest-big" id="rest-countdown">02:00</div>
  <div class="rest-next" id="rest-next-info">Next: DB Overhead Press</div>
  <button class="rest-skip" id="rest-skip">SKIP REST â†’</button>
</div>

<!-- SESSION COMPLETE -->
<div class="session-complete" id="session-complete">
  <div class="sc-icon">ğŸ†</div>
  <div class="sc-title">SESSION<br>COMPLETE</div>
  <div style="font-size:13px;color:var(--text3);text-align:center">That's another brick in the wall.</div>
  <div class="sc-stats" id="sc-stats"></div>
  <button class="btn btn-primary" id="sc-done-btn">BACK TO WORKOUT</button>
</div>

<div id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DAYS_SHORT = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

const WORKOUTS = [
  { name:'UPPER STRENGTH', meta:'Chest + Back Â· ~55 min', tag:'Day 1', met:5,
    exercises:[
      {n:'Smith Machine Bench Press', plan:'3â†’4 sets Â· 6â€“8 reps', planWeight:32.5, eq:'Smith Machine',
       tip:'Lower bar to chest, explosive drive up. Pause 1 sec on chest.',
       startWeight:32.5, increment:2.5},
      {n:'Assisted Pull-Ups', plan:'3 sets Â· 3â€“5 reps', planWeight:0, eq:'Pull-up bar',
       tip:'Dead hang start, chin clears bar. Control 3-sec negative.',
       startWeight:0, increment:0},
      {n:'Smith Bent-Over Row', plan:'3 sets Â· 8â€“10 reps', planWeight:27.5, eq:'Smith Machine',
       tip:'Flat back, pull bar to navel. Hard squeeze at top.',
       startWeight:27.5, increment:2.5},
      {n:'DB Overhead Press (seated)', plan:'3 sets Â· 8â€“10 reps', planWeight:9, eq:'Dumbbells',
       tip:'Elbows at 90Â°, press straight overhead. Full lockout.',
       startWeight:9, increment:1},
      {n:'Incline DB Press', plan:'3 sets Â· 8â€“10 reps', planWeight:9, eq:'DB + Bench',
       tip:'Upper chest focus. Controlled 3-sec descent.',
       startWeight:9, increment:1},
      {n:'Face Pulls', plan:'3 sets Â· 12â€“15 reps', planWeight:0, eq:'Cable',
       tip:'Elbows high, pull to forehead level. Rear delt focus.',
       startWeight:0, increment:0},
      {n:'Plank', plan:'3 sets Â· 25 sec (add 5 sec/week)', planWeight:0, eq:'Bodyweight',
       tip:'Straight line head to heels. Do NOT let hips sag.',
       startWeight:0, increment:0},
      {n:'Push-Up Practice', plan:'2 sets Â· Max reps', planWeight:0, eq:'Bodyweight',
       tip:'Slow and controlled. Track every rep â€” aim +1 each time.',
       startWeight:0, increment:0},
    ]},
  { name:'LOWER STRENGTH', meta:'Legs + Glutes Â· ~55 min', tag:'Day 2', met:6,
    exercises:[
      {n:'Smith Machine Squat', plan:'3â†’4 sets Â· 8â€“10 reps', planWeight:35, eq:'Smith Machine',
       tip:'Knees track over toes, break parallel. Control descent.',startWeight:35,increment:2.5},
      {n:'Leg Press', plan:'3 sets Â· 10â€“12 reps', planWeight:55, eq:'Machine',
       tip:'Full ROM. Do not lock out at top. Feet shoulder-width.',startWeight:55,increment:5},
      {n:'Smith Machine RDL', plan:'3 sets Â· 8â€“10 reps', planWeight:35, eq:'Smith Machine',
       tip:'Hinge at hips, back flat. Feel hamstring stretch at bottom.',startWeight:35,increment:2.5},
      {n:'Walking Lunges', plan:'3 sets Â· 10/leg', planWeight:0, eq:'Bodyweight',
       tip:'Long step, rear knee stops just before floor.',startWeight:0,increment:0},
      {n:'Leg Curl', plan:'3 sets Â· 10â€“12 reps', planWeight:0, eq:'Machine',
       tip:'Full extension, full curl. 4-sec slow negative.',startWeight:0,increment:0},
      {n:'Leg Extension', plan:'3 sets Â· 12â€“15 reps', planWeight:0, eq:'Machine',
       tip:'Squeeze hard at top. Slow descent.',startWeight:0,increment:0},
      {n:'Standing Calf Raises', plan:'3 sets Â· 20â€“25 reps', planWeight:0, eq:'BW / Machine',
       tip:'Heel fully below platform. Full stretch at bottom.',startWeight:0,increment:0},
      {n:'Hanging Knee Raises', plan:'3 sets Â· 10â€“12 reps', planWeight:0, eq:'Pull-up bar',
       tip:'Pull knees to chest. Control the descent.',startWeight:0,increment:0},
    ]},
  { name:'CARDIO + CORE', meta:'Fat Burn Â· ~50 min', tag:'Day 3', met:5,
    exercises:[
      {n:'Brisk Walk / Jog', plan:'20â€“30 min Â· Zone 2 Â· HR 119â€“139', planWeight:0, eq:'Outdoor',
       tip:'If you cannot speak a full sentence, you are going too fast. Slow down.',startWeight:0,increment:0},
      {n:'Plank', plan:'3 sets Â· 25â€“30 sec', planWeight:0, eq:'Bodyweight',
       tip:'Add 5 sec per week. Target 60 sec by Week 6.',startWeight:0,increment:0},
      {n:'Leg Raises', plan:'3 sets Â· 10â€“12 reps', planWeight:0, eq:'Bodyweight',
       tip:'Slow and controlled. Lower abs.',startWeight:0,increment:0},
      {n:'Russian Twists', plan:'3 sets Â· 20 reps', planWeight:0, eq:'Bodyweight',
       tip:'Bodyweight first. Add light plate from Week 5.',startWeight:0,increment:0},
      {n:'Dead Bug', plan:'3 sets Â· 8/side', planWeight:0, eq:'Bodyweight',
       tip:'Press lower back into floor the entire time.',startWeight:0,increment:0},
      {n:'Cable Woodchops', plan:'3 sets Â· 10/side', planWeight:0, eq:'Cable',
       tip:'Rotational core. Functional strength.',startWeight:0,increment:0},
      {n:'Mountain Climbers', plan:'2 sets Â· 25 sec', planWeight:0, eq:'Bodyweight',
       tip:'If HR > 155 bpm stop and rest before continuing.',startWeight:0,increment:0},
      {n:'Hollow Body Hold', plan:'2 sets Â· 20 sec', planWeight:0, eq:'Bodyweight',
       tip:'Lower back stays on floor the whole time.',startWeight:0,increment:0},
    ]},
  { name:'UPPER HYPERTROPHY', meta:'Volume + Arms Â· ~55 min', tag:'Day 4', met:5,
    exercises:[
      {n:'Incline DB Press', plan:'4 sets Â· 10â€“12 reps', planWeight:9, eq:'DB + Bench',
       tip:'Upper chest. 60â€“90 sec rest strictly.',startWeight:9,increment:1},
      {n:'Seated Cable Row', plan:'4 sets Â· 10â€“12 reps', planWeight:0, eq:'Cable',
       tip:'Hard squeeze at full contraction. Hold 1 sec.',startWeight:0,increment:0},
      {n:'Lat Pulldown', plan:'3 sets Â· 10â€“12 reps', planWeight:0, eq:'Cable',
       tip:'Wide lats = V-taper. Pull bar to upper chest.',startWeight:0,increment:0},
      {n:'Cable Fly / Pec Deck', plan:'3 sets Â· 12â€“15 reps', planWeight:0, eq:'Cable',
       tip:'2-sec squeeze at peak contraction every rep.',startWeight:0,increment:0},
      {n:'DB Bicep Curls', plan:'3 sets Â· 10â€“12 reps', planWeight:8, eq:'Dumbbells',
       tip:'3-sec slow negative. No swinging.',startWeight:8,increment:1},
      {n:'Rope Pushdowns', plan:'3 sets Â· 10â€“12 reps', planWeight:0, eq:'Cable',
       tip:'Full extension at bottom. Elbows pinned at sides.',startWeight:0,increment:0},
      {n:'Hammer Curls', plan:'2 sets Â· 12 reps', planWeight:8, eq:'Dumbbells',
       tip:'Brachialis. Adds arm thickness.',startWeight:8,increment:1},
      {n:'Rear Delt Cable Fly', plan:'3 sets Â· 12â€“15 reps', planWeight:0, eq:'Cable',
       tip:'Elbows wide. Pull back and apart.',startWeight:0,increment:0},
      {n:'Plank + Shoulder Taps', plan:'3 sets Â· 20 taps', planWeight:0, eq:'Bodyweight',
       tip:'Hips must stay perfectly square.',startWeight:0,increment:0},
    ]},
  { name:'LOWER + CARDIO', meta:'RDL Focus Â· ~55 min', tag:'Day 5', met:6,
    exercises:[
      {n:'Smith Machine RDL (Heavy)', plan:'4 sets Â· 6â€“8 reps', planWeight:40, eq:'Smith Machine',
       tip:'Primary strength lift. Add weight weekly.',startWeight:40,increment:2.5},
      {n:'Bulgarian Split Squat', plan:'3 sets Â· 8/leg', planWeight:0, eq:'BW / DB',
       tip:'Rear foot elevated. Deep front lunge.',startWeight:0,increment:0},
      {n:'Leg Press', plan:'3 sets Â· 12â€“15 reps', planWeight:65, eq:'Machine',
       tip:'Higher reps for pump and definition.',startWeight:65,increment:5},
      {n:'Hip Thrust', plan:'3 sets Â· 12 reps', planWeight:0, eq:'BW / Smith',
       tip:'Glute squeeze at top. Hold 1 full second.',startWeight:0,increment:0},
      {n:'Leg Extension', plan:'3 sets Â· 15 reps', planWeight:0, eq:'Machine',
       tip:'Slow and controlled.',startWeight:0,increment:0},
      {n:'Seated Calf Raise', plan:'3 sets Â· 20 reps', planWeight:0, eq:'Machine',
       tip:'Slow full range. Calves love volume.',startWeight:0,increment:0},
      {n:'Brisk Walk / Easy Jog', plan:'15 min finisher Â· Zone 2', planWeight:0, eq:'Outdoor',
       tip:'Fat burn on glycogen-depleted legs. Zone 2 only.',startWeight:0,increment:0},
    ]},
  { name:'SHOULDERS + ARMS', meta:'V-Taper Day Â· ~50 min', tag:'Day 6', met:5,
    exercises:[
      {n:'DB Shoulder Press (seated)', plan:'4 sets Â· 8â€“10 reps', planWeight:11, eq:'Dumbbells',
       tip:'Full ROM and control. You know this lift.',startWeight:11,increment:1},
      {n:'Lateral Raises (DB)', plan:'4 sets Â· 12â€“15 reps', planWeight:5, eq:'Dumbbells',
       tip:'SLOW: 2s up Â· 2s hold Â· 3s down. If not felt in side delt â€” reduce weight.',startWeight:5,increment:0.5},
      {n:'Cable Lateral Raises', plan:'3 sets Â· 15 reps', planWeight:0, eq:'Cable',
       tip:'Better bottom tension than DB. V-taper builder.',startWeight:0,increment:0},
      {n:'Rear Delt Cable Fly', plan:'3 sets Â· 12â€“15 reps', planWeight:0, eq:'Cable',
       tip:'3D shoulder shape. Light weight, controlled.',startWeight:0,increment:0},
      {n:'Smith Machine OHP (standing)', plan:'3 sets Â· 8â€“10 reps', planWeight:22.5, eq:'Smith Machine',
       tip:'Push for strength progression each session.',startWeight:22.5,increment:2.5},
      {n:'EZ Bar / DB Curl', plan:'3 sets Â· 8â€“10 reps', planWeight:11, eq:'Dumbbells',
       tip:'Full ROM. No swinging at top.',startWeight:11,increment:1},
      {n:'Incline DB Curl', plan:'3 sets Â· 10â€“12 reps', planWeight:7, eq:'DB + Bench',
       tip:'Stretch at bottom = fuller bicep shape.',startWeight:7,increment:0.5},
      {n:'Overhead Tricep Extension', plan:'3 sets Â· 10â€“12 reps', planWeight:0, eq:'Cable / DB',
       tip:'Long head. Arms look bigger from all angles.',startWeight:0,increment:0},
      {n:'Tricep Bench Dips', plan:'3 sets Â· 12â€“15 reps', planWeight:0, eq:'Bench',
       tip:'Elbows close to body throughout.',startWeight:0,increment:0},
    ]},
  { name:'REST DAY', meta:'Full Recovery Â· Light walk optional', tag:'Rest', met:1.5,
    exercises:[
      {n:'Light Home Walk', plan:'20 min optional Â· Zone 1',planWeight:0,eq:'Outdoor',tip:'Enjoy it.',startWeight:0,increment:0},
      {n:'Stretching', plan:'Hip flexors, hamstrings, shoulders',planWeight:0,eq:'Home',tip:'Hold each 30+ sec.',startWeight:0,increment:0},
      {n:'10:15 PM Alarm', plan:'Set tonight â€” protect sleep',planWeight:0,eq:'Phone',tip:'Sleep is training.',startWeight:0,increment:0},
    ]},
];

const QUICK_FOODS = [
  {name:'4 Boiled Eggs',icon:'ğŸ¥š',kcal:280,p:24,c:0,f:20},
  {name:'Dal (1 bowl)',icon:'ğŸ²',kcal:150,p:9,c:25,f:2},
  {name:'Rice (1 cup)',icon:'ğŸš',kcal:200,p:4,c:44,f:0},
  {name:'Chicken (100g)',icon:'ğŸ—',kcal:165,p:31,c:0,f:4},
  {name:'Paneer (100g)',icon:'ğŸ§€',kcal:265,p:18,c:3,f:20},
  {name:'Sattu (30g)',icon:'ğŸ’ª',kcal:120,p:11,c:16,f:2},
  {name:'Banana',icon:'ğŸŒ',kcal:90,p:1,c:23,f:0},
  {name:'Milk (250ml)',icon:'ğŸ¥›',kcal:150,p:8,c:12,f:8},
  {name:'Roti (1)',icon:'ğŸ«“',kcal:100,p:3,c:20,f:1},
  {name:'Soy Chunks (50g)',icon:'ğŸŒ±',kcal:175,p:25,c:12,f:1},
];

const QUOTES = [
  "72 kg. 30-inch waist. 10K in 30 minutes. It's already decided. Earn it today.",
  "The gym is 1 km away. That walk is already your cardio.",
  "Sleep is training. 10:15 pm. Wind down. Non-negotiable.",
  "Zone 2 check: can you say a full sentence? No? Slow down.",
  "Never miss twice. One is life. Two is a warning. Three is a dropout.",
  "Your only competition is yesterday's version of you.",
  "Slow is smooth. Smooth is fast. Trust the process.",
  "Muscle is built during sleep. Every hour before midnight is double.",
  "Drink your water. Pale yellow urine â€” that's the check.",
  "Dal, eggs, and a Smith machine. That's all you need.",
  "Discipline is the bridge between goals and accomplishment.",
  "The body achieves what the mind believes.",
  "Every rep, every set, every meal. It all adds up.",
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function today(){return new Date().toISOString().slice(0,10)}
function load(){try{return JSON.parse(localStorage.getItem('lj2')||'{}')}catch{return{}}}
function save(){localStorage.setItem('lj2',JSON.stringify(S))}

let S = load();
// Defaults
['streak','pushups'].forEach(k=>{if(!S[k])S[k]=0});
['streakLast','gymTime','theme'].forEach(k=>{if(S[k]===undefined)S[k]=''});
if(!S.theme)S.theme='dark';
if(!S.bodyLogs)S.bodyLogs=[];
if(!S.calLog)S.calLog={};
if(!S.workoutLog)S.workoutLog={};
if(!S.burnLog)S.burnLog={};
if(!S.waterLog)S.waterLog={};
if(!S.preworkoutLead)S.preworkoutLead=45;
if(!S.calTarget)S.calTarget={kcal:2200,p:140,c:240,f:60};
if(!S.exercisePR)S.exercisePR={};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentPage='home';
let activeDayIdx=new Date().getDay();

function todayWater(){return S.waterLog[today()]||0}
function todayCalLog(){return S.calLog[today()]||[]}
function todayBurn(){return S.burnLog[today()]||0}
function todayTotals(){
  return todayCalLog().reduce((a,f)=>{a.kcal+=f.kcal||0;a.p+=f.p||0;a.c+=f.c||0;a.f+=f.f||0;return a},{kcal:0,p:0,c:0,f:0});
}

function showToast(msg,dur=2500){
  const t=document.getElementById('toast');
  t.textContent=msg;t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),dur);
}

const overlay=document.getElementById('overlay');
overlay.addEventListener('click',closeSheets);

function openSheet(id){
  document.getElementById(id).classList.add('open');
  overlay.classList.add('open');
}
function closeSheets(){
  document.querySelectorAll('.sheet').forEach(s=>s.classList.remove('open'));
  overlay.classList.remove('open');
}

// Theme
function applyTheme(t){
  document.documentElement.setAttribute('data-theme',t);
  S.theme=t;save();
  document.getElementById('theme-meta').content=t==='dark'?'#0a0a0a':'#f4f4f0';
  document.getElementById('theme-toggle').checked=t==='dark';
}
applyTheme(S.theme||'dark');

document.getElementById('theme-toggle').addEventListener('change',function(){
  applyTheme(this.checked?'dark':'light');
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.querySelectorAll('.nav-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    const pg=btn.dataset.page;
    document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById('page-'+pg).classList.add('active');
    currentPage=pg;
    if(pg==='home')renderHome();
    if(pg==='workout')renderWorkout();
    if(pg==='cal')renderCalories();
    if(pg==='reports')renderReports('week');
    if(pg==='profile')renderProfile();
  });
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HOME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderHome(){
  const now=new Date();
  document.getElementById('hero-date').textContent=now.toLocaleDateString('en-US',{weekday:'long',day:'numeric',month:'long'});
  const h=now.getHours();
  document.getElementById('hero-word').textContent=h<12?'RISE.':h<17?'GRIND.':'BUILD.';
  const q=QUOTES[now.getDate()%QUOTES.length];
  document.getElementById('hero-quote').textContent='"'+q+'"';

  // Stats
  const last=S.bodyLogs[S.bodyLogs.length-1];
  document.getElementById('h-weight').innerHTML=(last?last.weight:'â€”')+'<em>kg</em>';
  document.getElementById('h-streak').innerHTML=S.streak+'<em>d</em>';
  const tot=todayTotals();
  document.getElementById('h-cal').innerHTML=(tot.kcal||'â€”')+'<em>c</em>';

  // Streak
  document.getElementById('streak-big').textContent=S.streak;
  const dotsEl=document.getElementById('streak-dots');
  dotsEl.innerHTML='';
  for(let i=0;i<7;i++){
    const d=document.createElement('div');
    d.className='streak-dot'+(i<S.streak%7?' on':'');
    dotsEl.appendChild(d);
  }

  // Gym time
  renderGymTime();

  // Water
  renderWater();

  // Notifications
  scheduleChecks();
}

function renderGymTime(){
  const gt=S.gymTime;
  const disp=document.getElementById('gym-time-display');
  const info=document.getElementById('preworkout-info');
  const countdown=document.getElementById('gym-countdown');

  if(!gt){disp.textContent='Not Set';info.textContent='';countdown.textContent='â€”';return;}

  const [h,m]=gt.split(':').map(Number);
  const now=new Date();
  const gymDate=new Date(now);gymDate.setHours(h,m,0,0);
  const lead=S.preworkoutLead||45;
  const preDate=new Date(gymDate.getTime()-lead*60000);

  const fmt=d=>{
    let hrs=d.getHours(),mins=d.getMinutes();
    const ampm=hrs>=12?'PM':'AM';hrs=hrs%12||12;
    return `${hrs}:${String(mins).padStart(2,'0')} ${ampm}`;
  };
  disp.textContent=fmt(gymDate);
  info.textContent=`Pre-workout at ${fmt(preDate)}`;

  const diffMs=gymDate-now;
  if(diffMs>0){
    const dh=Math.floor(diffMs/3600000);
    const dm=Math.floor((diffMs%3600000)/60000);
    countdown.textContent=dh>0?`${dh}h ${dm}m`:`${dm} min`;
  }else{
    countdown.textContent='GYM TIME!';
    countdown.style.color='var(--gold)';
  }
}

function renderWater(){
  const count=todayWater();
  document.getElementById('water-ml').textContent=(count*.5).toFixed(1)+'L';
  const el=document.getElementById('water-cups');
  el.innerHTML='';
  for(let i=0;i<7;i++){
    const c=document.createElement('div');
    c.className='wcup'+(i<count?' filled':'');
    c.addEventListener('click',()=>{
      const cur=S.waterLog[today()]||0;
      S.waterLog[today()]=i<cur?i:i+1;
      save();renderWater();
      document.getElementById('water-ml').textContent=((S.waterLog[today()]||0)*.5).toFixed(1)+'L';
      if((S.waterLog[today()]||0)>=7)showToast('ğŸ’§ Hydration goal hit!');
    });
    el.appendChild(c);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GYM TIME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.getElementById('set-gym-time-btn').addEventListener('click',()=>openSheet('gym-sheet'));

document.getElementById('gym-time-save').addEventListener('click',()=>{
  const t=document.getElementById('gym-time-inp').value;
  const lead=parseInt(document.getElementById('preworkout-lead').value);
  if(!t){showToast('Please select a time');return;}
  S.gymTime=t; S.preworkoutLead=lead; save();
  closeSheets(); renderGymTime();
  showToast('âœ… Gym time set! Reminders scheduled.');
  scheduleChecks();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NOTIFICATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let notifGranted=false;
let notifCheckInterval=null;

document.getElementById('notif-toggle').addEventListener('change',async function(){
  if(this.checked){
    const perm=await Notification.requestPermission();
    if(perm==='granted'){
      notifGranted=true;
      S.notifEnabled=true;save();
      document.getElementById('notif-status').textContent='Reminders active âœ“';
      showToast('ğŸ”” Notifications enabled!');
    }else{
      this.checked=false;
      showToast('Please allow notifications in browser settings');
    }
  }else{
    notifGranted=false;S.notifEnabled=false;save();
  }
});

// Init notif state
if(S.notifEnabled && Notification.permission==='granted'){
  notifGranted=true;
  document.getElementById('notif-toggle').checked=true;
  document.getElementById('notif-status').textContent='Reminders active âœ“';
}

function sendNotif(title,body){
  if(notifGranted&&Notification.permission==='granted'){
    new Notification(title,{body,icon:'icon-192.png',badge:'icon-192.png'});
  }
  // Also show in-app banner
  document.getElementById('notif-title').textContent=title;
  document.getElementById('notif-sub').textContent=body;
  document.getElementById('notif-banner').style.display='flex';
  setTimeout(()=>document.getElementById('notif-banner').style.display='none',8000);
}

let lastNotifKey='';
function scheduleChecks(){
  if(notifCheckInterval)clearInterval(notifCheckInterval);
  notifCheckInterval=setInterval(checkReminders,30000);
  checkReminders();
}

function checkReminders(){
  if(!S.gymTime)return;
  const now=new Date();
  const [h,m]=S.gymTime.split(':').map(Number);
  const gymDate=new Date(now);gymDate.setHours(h,m,0,0);
  const lead=S.preworkoutLead||45;
  const preDate=new Date(gymDate.getTime()-lead*60000);
  const waterReminderMins=[9*60,11*60,13*60,15*60,17*60,19*60,21*60];
  const nowMins=now.getHours()*60+now.getMinutes();

  // Pre-workout reminder
  const preMin=preDate.getHours()*60+preDate.getMinutes();
  const gymMin=gymDate.getHours()*60+gymDate.getMinutes();
  const key=`preworkout-${today()}`;
  if(Math.abs(nowMins-preMin)<=1&&lastNotifKey!==key){
    lastNotifKey=key;
    sendNotif('âš¡ Pre-Workout Time!',`Take your pre-workout now. Gym starts in ${lead} minutes!`);
  }

  // Gym time reminder
  const gymKey=`gym-${today()}`;
  if(Math.abs(nowMins-gymMin)<=1&&lastNotifKey!==gymKey){
    lastNotifKey=gymKey;
    sendNotif('ğŸ‹ï¸ GYM TIME!','Your session starts now. Walk to the gym â€” that\'s already your cardio.');
  }

  // Water reminders
  waterReminderMins.forEach(wm=>{
    const wkey=`water-${today()}-${wm}`;
    if(Math.abs(nowMins-wm)<=1&&lastNotifKey!==wkey){
      lastNotifKey=wkey;
      const cups=todayWater();
      if(cups<7){
        sendNotif('ğŸ’§ Drink Water',`You've had ${(cups*.5).toFixed(1)}L. Target: 3.5L. Drink a cup now.`);
      }
    }
  });

  // Morning motivation
  const mkey=`morning-${today()}`;
  if(nowMins>=8*60&&nowMins<=8*60+1&&lastNotifKey!==mkey){
    lastNotifKey=mkey;
    sendNotif('ğŸŒ… Good Morning','Today is another step toward 72 kg. Drink 500ml water now.');
  }
}
scheduleChecks();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WORKOUT PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderWorkout(){
  const nav=document.getElementById('day-scroll');
  const now=new Date();
  nav.innerHTML='';
  for(let i=0;i<7;i++){
    const d=new Date(now);
    d.setDate(now.getDate()-now.getDay()+i);
    const ds=d.toISOString().slice(0,10);
    const chip=document.createElement('div');
    chip.className='day-chip'
      +(i===activeDayIdx?' selected':'')
      +(i===now.getDay()?' today':'')
      +(S.workoutLog[ds]?' logged':'');
    chip.innerHTML=`<div class="d-name">${DAYS_SHORT[i]}</div>
      <div class="d-num">${d.getDate()}</div>
      <div class="d-done-dot"></div>`;
    chip.addEventListener('click',()=>{activeDayIdx=i;renderWorkout();});
    nav.appendChild(chip);
  }

  const w=WORKOUTS[activeDayIdx];
  document.getElementById('workout-day-lbl').textContent=DAYS_SHORT[activeDayIdx].toUpperCase()+' â€” '+w.name;
  document.getElementById('sesh-name').textContent=w.name;
  document.getElementById('sesh-meta').textContent=w.meta;
  document.getElementById('sesh-tag').textContent=w.tag;

  // Progress
  const selDate=new Date(now);selDate.setDate(now.getDate()-now.getDay()+activeDayIdx);
  const ds=selDate.toISOString().slice(0,10);
  const wlog=S.workoutLog[ds]||{};
  const done=w.exercises.filter((_,i)=>wlog[i]&&wlog[i].sets&&wlog[i].sets.length>0).length;
  const pct=w.exercises.length>0?done/w.exercises.length*100:0;
  document.getElementById('sesh-prog-bar').style.width=pct+'%';
  document.getElementById('sesh-prog-val').textContent=done+'/'+w.exercises.length;

  // Exercise list
  const list=document.getElementById('ex-list');
  list.innerHTML='';
  w.exercises.forEach((ex,i)=>{
    const logged=wlog[i]||{};
    const sets=logged.sets||[];
    const isDone=sets.length>0;
    const card=document.createElement('div');
    card.className='ex-card'+(isDone?' done-ex':'');
    card.dataset.idx=i;

    // Weight suggestion
    const pr=S.exercisePR[ex.n];
    let suggestText='';
    if(pr&&pr.weight>0){
      const nextW=pr.weight+(ex.increment||0);
      suggestText=`Last session: ${pr.weight}kg Ã— ${pr.reps} reps. Try <strong>${nextW}kg</strong> today (progressive overload +${ex.increment}kg).`;
    }else if(ex.startWeight>0){
      suggestText=`Starting weight suggestion: <strong>${ex.startWeight}kg</strong>. This is calibrated for your current level.`;
    }else{
      suggestText=`${ex.tip}`;
    }

    card.innerHTML=`
      <div class="ex-header">
        <div class="ex-num-badge${isDone?" done":""}">${isDone?"âœ“":(i+1)}</div>
        <div class="ex-name-wrap">
          <div class="ex-name">${ex.n}</div>
          <div class="ex-plan">${ex.plan} Â· ${ex.eq}</div>
        </div>
        <svg class="ex-chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
      </div>
      <div class="set-logger">
        <div class="suggest-box">
          <div class="suggest-title">ğŸ¤– Coach Says</div>
          <div class="suggest-txt">${suggestText}</div>
        </div>
        <div class="sets-logged" id="sets-logged-${i}">
          ${sets.map((s,si)=>`<div class="set-row-logged">
            <span class="set-row-lbl">Set ${si+1}</span>
            <span class="set-row-vals">${s.weight>0?s.weight+'kg Â· ':''}${s.reps} reps Â· ${s.rest}s rest</span>
            <span class="set-row-del" data-exidx="${i}" data-sidx="${si}">Ã—</span>
          </div>`).join('')}
        </div>
        <div class="set-inputs-row">
          <div class="set-inp-wrap">
            <div class="set-inp-lbl">Weight (kg)</div>
            <input class="set-inp" type="number" id="sinp-w-${i}" placeholder="${ex.startWeight||0}" inputmode="decimal">
          </div>
          <div class="set-inp-wrap">
            <div class="set-inp-lbl">Reps</div>
            <input class="set-inp" type="number" id="sinp-r-${i}" placeholder="8" inputmode="numeric">
          </div>
          <div class="set-inp-wrap">
            <div class="set-inp-lbl">Rest (sec)</div>
            <input class="set-inp" type="number" id="sinp-rest-${i}" placeholder="120" inputmode="numeric">
          </div>
        </div>
        <div class="set-btn-row">
          <button class="log-set-btn" data-idx="${i}">+ LOG SET ${sets.length+1}</button>
          ${isDone?`<button class="done-ex-btn" data-idx="${i}">âœ“ DONE</button>`:''}
        </div>
      </div>`;

    // Toggle expand
    card.querySelector('.ex-header').addEventListener('click',()=>{
      const wasExpanded=card.classList.contains('expanded');
      document.querySelectorAll('.ex-card').forEach(c=>c.classList.remove('expanded'));
      if(!wasExpanded)card.classList.add('expanded');
    });

    // Log set button
    card.querySelector('.log-set-btn').addEventListener('click',e=>{
      e.stopPropagation();
      const idx=parseInt(e.currentTarget.dataset.idx);
      logSet(idx,ds);
    });

    // Delete set
    card.querySelectorAll('.set-row-del').forEach(btn=>{
      btn.addEventListener('click',e=>{
        e.stopPropagation();
        const ei=parseInt(btn.dataset.exidx);
        const si=parseInt(btn.dataset.sidx);
        if(S.workoutLog[ds]&&S.workoutLog[ds][ei]){
          S.workoutLog[ds][ei].sets.splice(si,1);
          save();renderWorkout();
        }
      });
    });

    list.appendChild(card);
  });
}

function logSet(exIdx,ds){
  const ex=WORKOUTS[activeDayIdx].exercises[exIdx];
  const w=parseFloat(document.getElementById(`sinp-w-${exIdx}`).value)||ex.startWeight||0;
  const r=parseInt(document.getElementById(`sinp-r-${exIdx}`).value)||8;
  const rest=parseInt(document.getElementById(`sinp-rest-${exIdx}`).value)||120;

  if(!S.workoutLog[ds])S.workoutLog[ds]={};
  if(!S.workoutLog[ds][exIdx])S.workoutLog[ds][exIdx]={sets:[]};
  S.workoutLog[ds][exIdx].sets.push({weight:w,reps:r,rest});

  // Update PR
  if(!S.exercisePR[ex.n]||w>S.exercisePR[ex.n].weight||(w===S.exercisePR[ex.n].weight&&r>S.exercisePR[ex.n].reps)){
    S.exercisePR[ex.n]={weight:w,reps:r,date:ds};
  }

  // Update streak
  if(S.streakLast!==today()){
    const yesterday=new Date();yesterday.setDate(yesterday.getDate()-1);
    const yd=yesterday.toISOString().slice(0,10);
    S.streak=(S.streakLast===yd||!S.streakLast)?S.streak+1:1;
    S.streakLast=today();
  }
  save();

  showToast(`âœ… Set logged â€” ${w>0?w+'kg Â· ':''}${r} reps`);
  renderWorkout();
  renderHome();
}

// START SESSION BUTTON â€” Active session mode
document.getElementById('start-session-btn').addEventListener('click',()=>startActiveSession());

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACTIVE SESSION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let asCurrentEx=0;
let asSessionStart=null;
let asTimerInterval=null;
let restTimerInterval=null;
let asRestTarget=0;
let asRestRemaining=0;

function startActiveSession(){
  const w=WORKOUTS[activeDayIdx];
  if(w.tag==='Rest'){showToast('Rest day! Walk, stretch, and sleep.');return;}
  asCurrentEx=0;asSessionStart=Date.now();
  document.getElementById('as-session-name').textContent=w.name;
  document.getElementById('active-session').classList.add('open');
  // Session timer
  if(asTimerInterval)clearInterval(asTimerInterval);
  asTimerInterval=setInterval(()=>{
    const elapsed=Math.floor((Date.now()-asSessionStart)/1000);
    const mm=String(Math.floor(elapsed/60)).padStart(2,'0');
    const ss=String(elapsed%60).padStart(2,'0');
    document.getElementById('as-timer').textContent=mm+':'+ss;
  },1000);
  renderActiveEx();
}

function renderActiveEx(){
  const w=WORKOUTS[activeDayIdx];
  const ex=w.exercises[asCurrentEx];
  const pct=Math.round(asCurrentEx/w.exercises.length*100);

  document.getElementById('as-ex-count').textContent=`Exercise ${asCurrentEx+1} of ${w.exercises.length}`;
  document.getElementById('as-prog-bar').style.width=pct+'%';
  document.getElementById('as-prog-val').textContent=pct+'%';

  const ds=new Date().toISOString().slice(0,10);
  const exLog=S.workoutLog[ds]?.[asCurrentEx]||{sets:[]};
  const sets=exLog.sets||[];

  const pr=S.exercisePR[ex.n];
  let suggestHTML='';
  if(pr&&pr.weight>0){
    const nw=(pr.weight+(ex.increment||0));
    suggestHTML=`Last time: <strong>${pr.weight}kg Ã— ${pr.reps} reps</strong>.<br>Try <strong style="color:var(--gold)">${nw}kg</strong> today for progressive overload.`;
  }else if(ex.startWeight>0){
    suggestHTML=`Recommended starting weight: <strong style="color:var(--gold)">${ex.startWeight}kg</strong>`;
  }else{
    suggestHTML=`Bodyweight / machine. Focus on form.`;
  }

  const setsHTML=sets.map((s,i)=>`
    <div class="aex-set-logged">
      <div class="aex-set-lbl">Set ${i+1}</div>
      <div class="aex-set-vals">${s.weight>0?s.weight+'kg Â· ':''}${s.reps} reps Â· ${s.rest}s rest</div>
      <div class="aex-set-del" data-si="${i}">Ã—</div>
    </div>`).join('');

  const body=document.getElementById('as-body');
  body.innerHTML=`
    <div class="aex-card scale-in">
      <div class="aex-hdr">
        <div class="aex-num">Exercise ${asCurrentEx+1} of ${w.exercises.length}</div>
        <div class="aex-name">${ex.n}</div>
        <div class="aex-plan-detail">${ex.plan} Â· ${ex.eq}</div>
      </div>
      <div class="aex-suggest">
        <div class="aex-suggest-title">ğŸ¤– Coach Says</div>
        <div class="aex-suggest-body">${suggestHTML}<br><span style="color:var(--text3);font-style:italic">${ex.tip}</span></div>
      </div>
      ${sets.length>0?`<div class="aex-sets-done" id="aex-sets-done">${setsHTML}</div>`:''}
      <div class="aex-set-area">
        <div class="aex-set-title">Log Set ${sets.length+1}</div>
        <div class="aex-inputs">
          <div class="aex-inp-wrap"><div class="aex-inp-lbl">Weight (kg)</div>
            <input class="aex-inp" type="number" id="aex-w" placeholder="${ex.startWeight||'â€”'}" inputmode="decimal" value="${pr?.weight||ex.startWeight||''}"></div>
          <div class="aex-inp-wrap"><div class="aex-inp-lbl">Reps</div>
            <input class="aex-inp" type="number" id="aex-r" placeholder="8" inputmode="numeric"></div>
          <div class="aex-inp-wrap"><div class="aex-inp-lbl">Rest (s)</div>
            <input class="aex-inp" type="number" id="aex-rest" placeholder="120" inputmode="numeric"></div>
        </div>
      </div>
      <button class="aex-log-btn" id="aex-log-set-btn">+ LOG SET ${sets.length+1}</button>
      ${sets.length>0?`<button class="aex-done-btn" id="aex-done-ex-btn">âœ“ DONE WITH THIS EXERCISE</button>`:''}
    </div>`;

  // Log set
  document.getElementById('aex-log-set-btn').addEventListener('click',()=>{
    const wt=parseFloat(document.getElementById('aex-w').value)||ex.startWeight||0;
    const rp=parseInt(document.getElementById('aex-r').value)||8;
    const rt=parseInt(document.getElementById('aex-rest').value)||120;
    if(!S.workoutLog[ds])S.workoutLog[ds]={};
    if(!S.workoutLog[ds][asCurrentEx])S.workoutLog[ds][asCurrentEx]={sets:[]};
    S.workoutLog[ds][asCurrentEx].sets.push({weight:wt,reps:rp,rest:rt});
    if(!S.exercisePR[ex.n]||wt>S.exercisePR[ex.n].weight)S.exercisePR[ex.n]={weight:wt,reps:rp,date:ds};
    if(S.streakLast!==today()){
      const yd=new Date();yd.setDate(yd.getDate()-1);
      const yds=yd.toISOString().slice(0,10);
      S.streak=(S.streakLast===yds||!S.streakLast)?S.streak+1:1;
      S.streakLast=today();
    }
    save();
    // Show rest timer
    const nextEx=asCurrentEx+1<w.exercises.length?w.exercises[asCurrentEx+1]:null;
    startRestTimer(rt,nextEx?nextEx.n:'Last exercise â€” finish strong!');
    renderActiveEx();
  });

  // Delete set
  body.querySelectorAll('.aex-set-del').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const si=parseInt(btn.dataset.si);
      S.workoutLog[ds][asCurrentEx].sets.splice(si,1);
      save();renderActiveEx();
    });
  });

  // Done with exercise
  const doneBtn=document.getElementById('aex-done-ex-btn');
  if(doneBtn)doneBtn.addEventListener('click',()=>advanceExercise());
};

function startRestTimer(secs,nextName){
  asRestTarget=secs;asRestRemaining=secs;
  document.getElementById('rest-next-info').textContent='Next: '+nextName;
  document.getElementById('rest-countdown').textContent=fmtTime(secs);
  document.getElementById('rest-overlay').classList.add('open');
  if(restTimerInterval)clearInterval(restTimerInterval);
  restTimerInterval=setInterval(()=>{
    asRestRemaining--;
    document.getElementById('rest-countdown').textContent=fmtTime(asRestRemaining);
    if(asRestRemaining<=0){
      clearInterval(restTimerInterval);
      document.getElementById('rest-overlay').classList.remove('open');
      if('vibrate' in navigator)navigator.vibrate([300,100,300]);
      showToast('â± Rest done â€” next set!');
    }
  },1000);
}

function fmtTime(s){
  return String(Math.floor(s/60)).padStart(2,'0')+':'+String(Math.max(0,s%60)).padStart(2,'0');
}

document.getElementById('rest-skip').addEventListener('click',()=>{
  clearInterval(restTimerInterval);
  document.getElementById('rest-overlay').classList.remove('open');
});

function advanceExercise(){
  const w=WORKOUTS[activeDayIdx];
  asCurrentEx++;
  if(asCurrentEx>=w.exercises.length){
    finishSession();
  }else{
    renderActiveEx();
    document.getElementById('as-body').scrollTop=0;
  }
}

document.getElementById('as-next-btn').addEventListener('click',advanceExercise);
document.getElementById('as-prev-btn').addEventListener('click',()=>{
  if(asCurrentEx>0){asCurrentEx--;renderActiveEx();}
});

document.getElementById('as-close').addEventListener('click',()=>{
  if(confirm('End session?')){closeActiveSession();}
});

function closeActiveSession(){
  clearInterval(asTimerInterval);
  clearInterval(restTimerInterval);
  document.getElementById('active-session').classList.remove('open');
  document.getElementById('rest-overlay').classList.remove('open');
  renderWorkout();renderHome();
}

function finishSession(){
  clearInterval(asTimerInterval);
  clearInterval(restTimerInterval);
  document.getElementById('rest-overlay').classList.remove('open');
  document.getElementById('active-session').classList.remove('open');

  const w=WORKOUTS[activeDayIdx];
  const ds=today();
  const wlog=S.workoutLog[ds]||{};
  let totalSets=0,totalReps=0;
  Object.values(wlog).forEach(el=>{
    if(el.sets){el.sets.forEach(s=>{totalSets++;totalReps+=s.reps||0;});}
  });

  // Estimate burn
  const lastW=S.bodyLogs[S.bodyLogs.length-1];
  const bodyWeight=lastW?lastW.weight:85;
  const elapsed=Math.floor((Date.now()-asSessionStart)/1000/60);
  const burn=Math.round(w.met*bodyWeight*elapsed/60);

  document.getElementById('sc-stats').innerHTML=`
    <div class="sc-stat"><div class="sc-stat-val">${totalSets}</div><div class="sc-stat-lbl">Sets</div></div>
    <div class="sc-stat"><div class="sc-stat-val">${totalReps}</div><div class="sc-stat-lbl">Reps</div></div>
    <div class="sc-stat"><div class="sc-stat-val">${elapsed}</div><div class="sc-stat-lbl">Minutes</div></div>
    <div class="sc-stat"><div class="sc-stat-val">${burn}</div><div class="sc-stat-lbl">Est. Burned</div></div>`;

  document.getElementById('session-complete').classList.add('open');

  // Show burn confirm
  document.getElementById('burn-estimate').textContent=burn;
  document.getElementById('burn-adjust').value=burn;
  document.getElementById('burn-sheet-sub').textContent=`${w.name} for ~${elapsed} min at ${bodyWeight}kg bodyweight:`;

  document.getElementById('sc-done-btn').addEventListener('click',()=>{
    document.getElementById('session-complete').classList.remove('open');
    openSheet('burn-sheet');
    renderWorkout();renderHome();
  },{once:true});
}

document.getElementById('burn-confirm').addEventListener('click',()=>{
  const b=parseInt(document.getElementById('burn-adjust').value)||0;
  S.burnLog[today()]=(S.burnLog[today()]||0)+b;
  save();closeSheets();renderCalories();renderHome();
  showToast(`ğŸ”¥ ${b} kcal burn logged!`);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CALORIES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderCalories(){
  document.getElementById('cal-date-lbl').textContent=new Date().toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'});
  const tot=todayTotals();
  const burn=todayBurn();
  const tgt=S.calTarget;
  const net=tgt.kcal+burn-tot.kcal;

  document.getElementById('cal-remain').textContent=Math.max(0,net);
  document.getElementById('cal-eaten').textContent=tot.kcal;
  document.getElementById('cal-burned-txt').textContent=burn;
  document.getElementById('burn-display').textContent=burn;

  document.getElementById('val-p').textContent=tot.p;
  document.getElementById('val-c').textContent=tot.c;
  document.getElementById('val-f').textContent=tot.f;
  document.getElementById('tgt-p').textContent=tgt.p;
  document.getElementById('tgt-c').textContent=tgt.c;
  document.getElementById('tgt-f').textContent=tgt.f;

  const pct=Math.min(1,tot.kcal/tgt.kcal);
  document.getElementById('ring-arc').style.strokeDashoffset=226-226*pct;
  document.getElementById('ring-pct').textContent=Math.round(pct*100)+'%';
  document.getElementById('bar-p').style.width=Math.min(100,tot.p/tgt.p*100)+'%';
  document.getElementById('bar-c').style.width=Math.min(100,tot.c/tgt.c*100)+'%';
  document.getElementById('bar-f').style.width=Math.min(100,tot.f/tgt.f*100)+'%';

  // Quick foods
  const qg=document.getElementById('qfood-grid');qg.innerHTML='';
  QUICK_FOODS.forEach(f=>{
    const btn=document.createElement('div');btn.className='qfood';
    btn.innerHTML=`<div class="qfood-em">${f.icon}</div><div><div class="qfood-name">${f.name}</div><div class="qfood-kcal">${f.kcal}kcal Â· P:${f.p}g</div></div>`;
    btn.addEventListener('click',()=>{
      if(!S.calLog[today()])S.calLog[today()]=[];
      S.calLog[today()].push({...f,id:Date.now()});
      save();renderCalories();renderHome();
      showToast(`${f.icon} ${f.name} logged!`);
    });
    qg.appendChild(btn);
  });

  // Food list
  const fl=document.getElementById('food-log-list');
  const log=todayCalLog();
  if(!log.length){fl.innerHTML='<div style="color:var(--text3);font-size:13px;text-align:center;padding:24px">No food logged yet</div>';return;}
  fl.innerHTML='';
  log.forEach((f,i)=>{
    const item=document.createElement('div');item.className='food-item fade-up';
    item.innerHTML=`<div class="food-em">${f.icon||'ğŸ½'}</div>
      <div class="food-info"><div class="food-name">${f.name}</div><div class="food-macros">P:${f.p}g Â· C:${f.c}g Â· F:${f.f}g</div></div>
      <div class="food-kcal">${f.kcal}</div>
      <div class="food-del" data-i="${i}"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></div>`;
    item.querySelector('.food-del').addEventListener('click',()=>{
      S.calLog[today()].splice(i,1);save();renderCalories();renderHome();
    });
    fl.appendChild(item);
  });
}

// FAB for food
const fab=document.createElement('button');
fab.style.cssText='position:fixed;right:20px;bottom:calc(72px + env(safe-area-inset-bottom,0px));width:50px;height:50px;border-radius:15px;background:var(--gold);color:#000;border:none;cursor:pointer;z-index:99;font-size:22px;display:none;align-items:center;justify-content:center;box-shadow:0 4px 18px rgba(232,197,71,.35);transition:transform .12s';
fab.innerHTML='+';
fab.addEventListener('click',()=>{if(currentPage==='cal')openSheet('food-sheet');if(currentPage==='profile')openSheet('body-sheet');});
fab.addEventListener('mousedown',()=>fab.style.transform='scale(.93)');
fab.addEventListener('mouseup',()=>fab.style.transform='scale(1)');
document.getElementById('app').appendChild(fab);

document.querySelectorAll('.nav-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    fab.style.display=(btn.dataset.page==='cal'||btn.dataset.page==='profile')?'flex':'none';
  });
});

// Food save
document.getElementById('food-save').addEventListener('click',()=>{
  const name=document.getElementById('f-name').value.trim();
  const kcal=parseInt(document.getElementById('f-kcal').value)||0;
  const p=parseInt(document.getElementById('f-p').value)||0;
  const c=parseInt(document.getElementById('f-c').value)||0;
  const f=parseInt(document.getElementById('f-f').value)||0;
  if(!name||!kcal){showToast('Add name and calories');return;}
  if(!S.calLog[today()])S.calLog[today()]=[];
  S.calLog[today()].push({name,kcal,p,c,f,icon:'ğŸ½',id:Date.now()});
  save();['f-name','f-kcal','f-p','f-c','f-f'].forEach(id=>document.getElementById(id).value='');
  closeSheets();renderCalories();renderHome();
  showToast('âœ… '+name+' logged!');
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REPORTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let reportPeriod='week';
document.getElementById('report-tabs').querySelectorAll('.r-tab').forEach(tab=>{
  tab.addEventListener('click',()=>{
    document.querySelectorAll('.r-tab').forEach(t=>t.classList.remove('active'));
    tab.classList.add('active');
    reportPeriod=tab.dataset.period;
    renderReports(reportPeriod);
  });
});

function getDateRange(period){
  const now=new Date();
  const end=new Date(now);end.setHours(23,59,59,999);
  const start=new Date(now);
  if(period==='week')start.setDate(now.getDate()-6);
  else if(period==='month')start.setDate(now.getDate()-29);
  else if(period==='quarter')start.setDate(now.getDate()-89);
  else start.setDate(now.getDate()-364);
  start.setHours(0,0,0,0);
  return{start,end};
}

function getDatesInRange(start,end){
  const dates=[];const d=new Date(start);
  while(d<=end){dates.push(d.toISOString().slice(0,10));d.setDate(d.getDate()+1);}
  return dates;
}

function renderReports(period){
  const{start,end}=getDateRange(period);
  const dates=getDatesInRange(start,end);
  const tgt=S.calTarget;
  const BMR=1900; // ~kcal/day at target weight

  let totalConsumed=0,totalBurned=0,sessions=0;
  dates.forEach(d=>{
    const log=S.calLog[d]||[];
    totalConsumed+=log.reduce((a,f)=>a+(f.kcal||0),0);
    totalBurned+=S.burnLog[d]||0;
    if(S.workoutLog[d]&&Object.keys(S.workoutLog[d]).length>0)sessions++;
  });
  const bmrTotal=BMR*dates.length;
  const netDeficit=bmrTotal+totalBurned-totalConsumed;
  const label=period==='week'?'This Week':period==='month'?'This Month':period==='quarter'?'This Quarter':'This Year';

  // Deficit card
  document.getElementById('deficit-num').textContent=Math.max(0,netDeficit).toLocaleString();
  document.getElementById('deficit-sub').textContent=netDeficit>0?`${label}: You're in a deficit â€” fat loss happening`:`${label}: Eat less or move more to create deficit`;
  document.getElementById('deficit-card')||0;
  document.getElementById('r-consumed').textContent=totalConsumed.toLocaleString();
  document.getElementById('r-burned').textContent=totalBurned.toLocaleString();
  document.getElementById('r-bmr').textContent=bmrTotal.toLocaleString();

  // Deficit card color
  const dc=document.querySelector('.deficit-card');
  if(netDeficit>0){
    dc.style.background='linear-gradient(135deg,rgba(76,175,125,.15),rgba(76,175,125,.05))';
    dc.style.borderColor='rgba(76,175,125,.3)';
    document.querySelector('.deficit-title').style.color='var(--green)';
    document.getElementById('deficit-num').parentElement.style.color='var(--green)';
  }else{
    dc.style.background='linear-gradient(135deg,rgba(224,82,82,.1),rgba(224,82,82,.03))';
    dc.style.borderColor='rgba(224,82,82,.3)';
  }

  // KPIs
  const kpiGrid=document.getElementById('report-kpis');
  const avgCal=dates.length>0?Math.round(totalConsumed/dates.length):0;
  const bodyLogs=S.bodyLogs.filter(l=>l.date>=dates[0]);
  const firstW=bodyLogs[0]?.weight;const lastW=bodyLogs[bodyLogs.length-1]?.weight;
  const wChange=firstW&&lastW?+(lastW-firstW).toFixed(1):null;

  kpiGrid.innerHTML=`
    <div class="kpi-card">
      <div class="kpi-val">${sessions}<em>x</em></div>
      <div class="kpi-lbl">Sessions</div>
      <div class="kpi-change good">Active days</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-val">${avgCal}<em>c</em></div>
      <div class="kpi-lbl">Avg Daily Cal</div>
      <div class="kpi-change ${avgCal>tgt.kcal?'bad':'good'}">${avgCal>tgt.kcal?'Over target':'On target'}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-val">${lastW||'â€”'}<em>kg</em></div>
      <div class="kpi-lbl">Current Weight</div>
      <div class="kpi-change ${wChange<0?'good':'bad'}">${wChange!==null?(wChange>0?'+':'')+wChange+'kg':'No data'}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-val">${S.streak}<em>d</em></div>
      <div class="kpi-lbl">Streak</div>
      <div class="kpi-change good">Keep going</div>
    </div>`;

  document.getElementById('weight-chart-title').textContent='WEIGHT â€” '+label.toUpperCase();

  // Weight chart
  renderLineChart('weight-chart',bodyLogs.map(l=>l.weight),'kg','#e8c547');
  // Body chart (waist)
  renderLineChart('body-chart',bodyLogs.filter(l=>l.waist).map(l=>l.waist),'in','#5b8dee');

  // Strength progression
  const epList=document.getElementById('ex-prog-list');epList.innerHTML='';
  const tracked=['Smith Machine Bench Press','Smith Machine Squat','Smith Machine RDL','DB Shoulder Press (seated)','Lateral Raises (DB)'];
  tracked.forEach(name=>{
    const pr=S.exercisePR[name];
    // Find starting weight from exercises data
    const exDef=WORKOUTS.flatMap(w=>w.exercises).find(e=>e.n===name);
    const startW=exDef?.startWeight||0;
    if(!pr&&!startW)return;
    const card=document.createElement('div');card.className='ex-prog-card';
    const gain=pr&&startW>0?+(pr.weight-startW).toFixed(1):null;
    card.innerHTML=`
      <div class="ex-prog-name">${name}</div>
      <div class="ex-prog-nums">
        <div class="ex-prog-start">Started: ${startW}kg</div>
        <div class="ex-prog-now">${pr?pr.weight+'kg Ã— '+pr.reps+' reps':'No data yet'}</div>
      </div>
      ${gain!==null?`<div class="prog-track"><div class="prog-fill" style="width:${Math.min(100,Math.abs(gain)/30*100)+'%'}"></div></div>
      <div style="font-size:10px;color:var(--green);margin-top:4px">+${gain}kg from start</div>`:''}`;
    epList.appendChild(card);
  });
}

function renderLineChart(svgId,vals,unit,color){
  const svg=document.getElementById(svgId);
  svg.innerHTML='';
  const W=svg.clientWidth||svg.parentElement?.clientWidth||340;
  const H=100,pad=20;
  if(!vals||vals.length<2){
    svg.innerHTML=`<text x="${W/2}" y="50" text-anchor="middle" fill="var(--text3)" font-size="11" font-family="DM Sans">Log data to see chart</text>`;
    return;
  }
  const min=Math.min(...vals)-1,max=Math.max(...vals)+1;
  const pts=vals.map((v,i)=>{
    return[pad+i/(vals.length-1)*(W-pad*2),H-pad-(v-min)/(max-min)*(H-pad*2)];
  });
  const pathD='M'+pts.map(p=>p[0].toFixed(1)+','+p[1].toFixed(1)).join(' L');
  const areaD=pathD+` L${pts[pts.length-1][0]},${H} L${pts[0][0]},${H} Z`;
  const gid='cg'+svgId;
  svg.innerHTML=`<defs>
    <linearGradient id="${gid}" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="${color}" stop-opacity=".2"/>
      <stop offset="100%" stop-color="${color}" stop-opacity="0"/>
    </linearGradient></defs>
    <path d="${areaD}" fill="url(#${gid})"/>
    <path d="${pathD}" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    ${pts.map((p,i)=>`<circle cx="${p[0].toFixed(1)}" cy="${p[1].toFixed(1)}" r="3" fill="${color}"/>`).join('')}
    <text x="${pts[pts.length-1][0]}" y="${(pts[pts.length-1][1]-8).toFixed(1)}" text-anchor="middle" fill="${color}" font-size="10" font-family="DM Mono,monospace">${vals[vals.length-1]}${unit}</text>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PROFILE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.getElementById('log-body-btn').addEventListener('click',()=>openSheet('body-sheet'));
document.getElementById('pu-up').addEventListener('click',()=>{S.pushups++;document.getElementById('pushup-val').textContent=S.pushups;save();});
document.getElementById('pu-dn').addEventListener('click',()=>{S.pushups=Math.max(0,S.pushups-1);document.getElementById('pushup-val').textContent=S.pushups;save();});

document.getElementById('body-save').addEventListener('click',()=>{
  const w=parseFloat(document.getElementById('bl-w').value);
  const ws=parseFloat(document.getElementById('bl-ws').value);
  const rhr=parseInt(document.getElementById('bl-rhr').value);
  const sl=parseFloat(document.getElementById('bl-sl').value);
  if(!w){showToast('Enter at least your weight');return;}
  S.bodyLogs.push({date:today(),weight:w,waist:ws||null,rhr:rhr||null,sleep:sl||null});
  save();['bl-w','bl-ws','bl-rhr','bl-sl'].forEach(id=>document.getElementById(id).value='');
  closeSheets();renderProfile();renderHome();
  showToast('ğŸ“Š Stats saved!');
});

function renderProfile(){
  document.getElementById('pushup-val').textContent=S.pushups||0;
  const logs=S.bodyLogs;
  const last=logs[logs.length-1];
  const prev=logs[logs.length-2];

  const bm=document.getElementById('body-metrics');
  const metrics=[
    {id:'bm-w',val:last?.weight,prev:prev?.weight,unit:'kg',lbl:'Weight',lower:true},
    {id:'bm-ws',val:last?.waist,prev:prev?.waist,unit:'in',lbl:'Waist',lower:true},
    {id:'bm-rhr',val:last?.rhr,prev:prev?.rhr,unit:'bpm',lbl:'Resting HR',lower:true},
    {id:'bm-sl',val:last?.sleep,prev:prev?.sleep,unit:'hr',lbl:'Sleep',lower:false},
  ];
  bm.innerHTML='';
  metrics.forEach(m=>{
    const diff=m.val&&m.prev?+(m.val-m.prev).toFixed(1):null;
    const better=diff!==null?(m.lower?diff<0:diff>0):null;
    bm.innerHTML+=`<div class="bm-card">
      <div class="bm-val">${m.val!=null?m.val:'â€”'}<em>${m.unit}</em></div>
      <div class="bm-lbl">${m.lbl}</div>
      <div class="bm-chg" style="color:${better===null?'var(--text3)':better?'var(--green)':'var(--red)'}">
        ${diff!==null?(diff>0?'+':'')+diff+m.unit:''}</div>
    </div>`;
  });

  // Progress bars â€” use current phase targets
  const ph=getCurrentPhase();
  const startW=92,targetW=ph.year===2?68:73;
  const curW=last?.weight||startW;
  document.getElementById('prog-w').style.width=Math.min(100,Math.max(0,(startW-curW)/(startW-targetW)*100))+'%';
  document.getElementById('prog-w-lbl').textContent=`${startW} â†’ ${targetW} kg (Phase ${ph.id})`;

  const startWs=38,targetWs=ph.year===2?27:30;
  const curWs=last?.waist||startWs;
  document.getElementById('prog-ws').style.width=Math.min(100,Math.max(0,(startWs-curWs)/(startWs-targetWs)*100))+'%';

  // Phase targets card
  renderPhaseTargetsCard();

  // Milestones list
  renderMilestones();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PLAN PHASES DATA (from 2-Year Plan PDF)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PLAN_PHASES=[
  {id:1,year:1,months:'1â€“3',name:'Foundation',focus:'Learn movements, build cardio base, lose first 10 kg',weight:'82â€“88 kg',waist:'35â€“36 in',cardio:'Walk 30 min, HR < 140',kcal:2200,protein:140,carbs:240,fat:60,
   cal:{kcal:2200,p:140,c:240,f:60},body:{weight:'82â€“88 kg',waist:'35â€“36 in'},color:'#e8c547',
   gym:'Learning form, small PRs',look:'Slightly leaner, energy better',running:'Brisk walk only (20â€“25 min)',
   notes:'Zero running for first 8 weeks. Zone 2 walks only. Walk to gym every session â€” 2 km free cardio daily.'},
  {id:2,year:1,months:'4â€“6',name:'Walk-Run',focus:'Introduce running, strength PRs, visible fat loss',weight:'77â€“82 kg',waist:'33â€“35 in',cardio:'Run 5 min non-stop',kcal:2000,protein:140,carbs:218,fat:55,
   cal:{kcal:2000,p:140,c:218,f:55},body:{weight:'77â€“82 kg',waist:'33â€“35 in'},color:'#e8a247',
   gym:'Consistent PRs, all compounds',look:'Noticeably leaner, jawline thinner',running:'Walk-run intervals â†’ 20 min easy run',
   notes:'Start jogging intervals. Walk 3 min / Jog 1 min Ã— 6. HR stays under 152 bpm.'},
  {id:3,year:1,months:'7â€“9',name:'Endurance',focus:'5K running, physique taking shape, strength base',weight:'74â€“77 kg',waist:'31â€“33 in',cardio:'Run 5K continuously',kcal:1900,protein:140,carbs:205,fat:52,
   cal:{kcal:1900,p:140,c:205,f:52},body:{weight:'74â€“77 kg',waist:'31â€“33 in'},color:'#e07a47',
   gym:'Real PRs, push-ups 15+',look:'Athletic, lean, clear muscle definition',running:'3 easy runs + 1 long run up to 8 km',
   notes:'Push-ups should exceed 15 by Month 7. V-taper beginning to emerge. 5K continuous run achieved.'},
  {id:4,year:1,months:'10â€“12',name:'Race + Shred',focus:'10K training, shredded look, Year 1 goal achieved',weight:'72â€“74 kg',waist:'30 in',cardio:'10K in 30 min âœ“',kcal:1850,protein:140,carbs:198,fat:50,
   cal:{kcal:1850,p:140,c:198,f:50},body:{weight:'72â€“74 kg',waist:'30 in'},color:'#4caf7d',
   gym:'Intermediate strength across all lifts',look:'Lean, dense, shredded, fast',running:'2 easy + 1 tempo + 1 long run Â· pace 3:00/km',
   notes:'YEAR 1 GOAL ACHIEVED. 72â€“74 kg. 30-inch waist. 5+ unassisted pull-ups. Shredded V-taper.'},
  {id:5,year:2,months:'13â€“15',name:'Recomp',focus:'Maintain weight, swap remaining fat for lean muscle',weight:'70â€“73 kg',waist:'29â€“30 in',cardio:'10K under 28 min',kcal:1950,protein:155,carbs:200,fat:55,
   cal:{kcal:1950,p:155,c:200,f:55},body:{weight:'70â€“73 kg',waist:'29â€“30 in'},color:'#5b8dee',
   gym:'Bench 65+ kg Â· 8+ pull-ups Â· RDL 80+ kg',look:'Leaner at same weight â€” recomp working',running:'Continuous easy run 25â€“30 min Zone 2',
   notes:'Scale barely moves â€” mirror tells a different story. Body fat dropping while muscle increases. Trust the process.'},
  {id:6,year:2,months:'16â€“18',name:'Strength',focus:'Push strength ceiling, athletic conditioning upgrades',weight:'69â€“71 kg',waist:'28â€“29 in',cardio:'10K under 27 min',kcal:2050,protein:160,carbs:212,fat:58,
   cal:{kcal:2050,p:160,c:212,f:58},body:{weight:'69â€“71 kg',waist:'28â€“29 in'},color:'#9c59d1',
   gym:'Bench 72+ kg Â· weighted pull-ups Â· push-ups 35+',look:'Visibly more muscular and shredded â€” people notice',running:'Tempo: 5 min warm-up + 15 min Zone 3â€“4 + 5 min cooldown',
   notes:'Periodisation kicks in: Volume week â†’ Strength week â†’ Volume week â†’ Deload week. Never skip Deload.'},
  {id:7,year:2,months:'19â€“21',name:'Elite Lean',focus:'Shredded maintenance, power output, speed phases',weight:'68â€“70 kg',waist:'27â€“28 in',cardio:'10K under 26.5 min',kcal:1950,protein:160,carbs:200,fat:55,
   cal:{kcal:1950,p:160,c:200,f:55},body:{weight:'68â€“70 kg',waist:'27â€“28 in'},color:'#e05252',
   gym:'Peak compound lifts Â· strides dialled in',look:'Elite lean look. The physique that earns respect.',running:'Intervals: 6 Ã— 3 min Zone 4 with 90 sec easy recovery',
   notes:'10â€“12% body fat range. The genuinely shredded range. Dragon flag progression added to core work.'},
  {id:8,year:2,months:'22â€“24',name:'Mastery',focus:'Peak physique locked in, sustainable lifestyle, race PR',weight:'68â€“70 kg',waist:'27 in',cardio:'10K under 26 min',kcal:2000,protein:165,carbs:205,fat:57,
   cal:{kcal:2000,p:165,c:205,f:57},body:{weight:'68â€“70 kg',waist:'27 in'},color:'#e8c547',
   gym:'Intermediate-advanced across all lifts',look:'Physique proud of for life. Done.',running:'Race intervals: 4 Ã— 1 km at 2:36/km pace',
   notes:'THE FINAL FORM. 68â€“70 kg. 27-inch waist. Dense lean muscle. 10K in 26 minutes. Built on dal, eggs, and a Smith machine.'},
];

const MILESTONES=[
  {period:'Week 1â€“4',weight:'88â€“91 kg',waist:'~37.5 in',cardio:'Walk 25 min, HR settling',gym:'Learning form each session',look:'Very slightly leaner, energy better'},
  {period:'Week 5â€“8',weight:'84â€“87 kg',waist:'~36 in',cardio:'Walk 30 min, HR < 140',gym:'Consistent PRs, small weight jumps',look:'Noticeably leaner, jawline thinner'},
  {period:'Week 9â€“12',weight:'79â€“82 kg',waist:'~34 in',cardio:'Walk-jog intervals, HR < 152',gym:'Real PRs on all compounds',look:'V-taper emerging, arms defined'},
  {period:'Month 4â€“6',weight:'74â€“77 kg',waist:'~32 in',cardio:'Run 5K continuously',gym:'Push-ups 15+, solid compounds',look:'Athletic, lean, clear muscle definition'},
  {period:'Month 7â€“9',weight:'72â€“75 kg',waist:'~31 in',cardio:'Run 8K easy',gym:'5+ unassisted pull-ups',look:'Shredded, clear V-taper visible'},
  {period:'Month 10â€“12',weight:'72â€“74 kg',waist:'~30 in',cardio:'10K in 30 min âœ“',gym:'Intermediate strength â€” Year 1 done',look:'Lean, dense, shredded, fast â€” GOAL HIT'},
  {period:'Month 13â€“15',weight:'70â€“73 kg',waist:'~29â€“30 in',cardio:'10K under 28 min',gym:'Bench 65+ kg Â· 8 pull-ups',look:'Leaner at same weight â€” recomp evident'},
  {period:'Month 16â€“18',weight:'69â€“71 kg',waist:'~28â€“29 in',cardio:'10K under 27 min',gym:'Bench 72+ kg Â· weighted pull-ups',look:'More muscular and shredded â€” people notice'},
  {period:'Month 19â€“21',weight:'68â€“70 kg',waist:'~28 in',cardio:'10K under 26.5 min',gym:'Peak compound lifts across all sessions',look:'Elite lean look. Earns genuine respect.'},
  {period:'Month 22â€“24',weight:'68â€“70 kg',waist:'~27 in',cardio:'10K under 26 min',gym:'Intermediate-advanced across all lifts',look:'Physique proud of for life. Done.'},
];

function getCurrentPhase(){
  return PLAN_PHASES.find(p=>p.id===(S.planPhase||1))||PLAN_PHASES[0];
}

function renderPhaseOptionsInSheet(){
  const container=document.getElementById('phase-options');
  container.innerHTML='';
  const cur=S.planPhase||1;
  PLAN_PHASES.forEach(ph=>{
    const el=document.createElement('div');
    el.className='phase-option-card'+(ph.id===cur?' selected':'');
    el.innerHTML=`
      <div class="phase-option-year">${ph.year===1?'Year 1':'Year 2'} Â· Month ${ph.months}</div>
      <div class="phase-option-name">Phase ${ph.id} â€” ${ph.name}</div>
      <div class="phase-option-months">${ph.focus}</div>`;
    el.addEventListener('click',()=>{
      S.planPhase=ph.id;
      // Auto-update calorie targets to match phase
      S.calTarget={kcal:ph.kcal,protein:ph.protein,carbs:ph.carbs,fat:ph.fat};
      save();
      updateSettingsDisplay();
      renderPhaseTargetsCard();
      renderMilestones();
      closeSheets();
      showToast(`ğŸ“… Phase ${ph.id}: ${ph.name} selected`);
    });
    container.appendChild(el);
  });
}

function updateSettingsDisplay(){
  const ph=getCurrentPhase();
  const t=S.calTarget||{kcal:ph.kcal,p:ph.protein,c:ph.carbs,f:ph.fat};
  // Support both old format (protein/carbs/fat) and new format (p/c/f)
  const pVal=t.p||t.protein||0;
  const cVal=t.c||t.carbs||0;
  const fVal=t.f||t.fat||0;
  document.getElementById('cal-target-sub').textContent=
    `${t.kcal.toLocaleString()} kcal Â· P:${pVal}g C:${cVal}g F:${fVal}g`;
  document.getElementById('plan-phase-sub').textContent=
    `Year ${ph.year} Â· Month ${ph.months} Â· ${ph.name}`;
}

function renderPhaseTargetsCard(){
  const ph=getCurrentPhase();
  const container=document.getElementById('phase-targets-card');
  container.innerHTML=`<div class="phase-target-card">
    <div class="phase-target-title">Phase ${ph.id} â€” ${ph.name}</div>
    <div class="phase-target-sub">Year ${ph.year} Â· Month ${ph.months}<br>${ph.focus}</div>
    <div class="phase-targets-grid">
      <div class="phase-target-item">
        <div class="phase-target-item-val">${ph.weight}</div>
        <div class="phase-target-item-lbl">Target Weight</div>
      </div>
      <div class="phase-target-item">
        <div class="phase-target-item-val">${ph.waist}</div>
        <div class="phase-target-item-lbl">Target Waist</div>
      </div>
      <div class="phase-target-item">
        <div class="phase-target-item-val">${ph.kcal.toLocaleString()} kcal</div>
        <div class="phase-target-item-lbl">Daily Calories</div>
      </div>
      <div class="phase-target-item">
        <div class="phase-target-item-val">${ph.protein}g P Â· ${ph.carbs}g C</div>
        <div class="phase-target-item-lbl">Protein Â· Carbs</div>
      </div>
      <div class="phase-target-item" style="grid-column:1/-1">
        <div class="phase-target-item-val">${ph.cardio}</div>
        <div class="phase-target-item-lbl">Cardio Target</div>
      </div>
    </div>
  </div>`;
}

function renderMilestones(){
  const list=document.getElementById('milestones-list');
  list.innerHTML='';
  const curW=(S.bodyLogs[S.bodyLogs.length-1]?.weight)||92;
  MILESTONES.forEach((m,i)=>{
    // Determine status
    const targetW=parseFloat(m.weight.split('â€“')[1]||m.weight)||92;
    const isYear2=m.period.includes('13')||m.period.includes('16')||m.period.includes('19')||m.period.includes('22');
    let status='future';
    if(curW<=targetW+1&&!isYear2) status='current';
    if(curW<targetW-1) status='achieved';
    if(isYear2&&curW<=74) status='future';

    const el=document.createElement('div');
    el.className=`milestone-card ${status==='achieved'?'achieved':status==='current'?'current-phase':'future'}`;
    el.innerHTML=`
      <div class="milestone-badge ${status}">${status==='achieved'?'âœ“ Done':status==='current'?'â— Now':'Future'}</div>
      <div class="milestone-period">${m.period}${m.period.includes('13')||m.period.includes('16')||m.period.includes('19')||m.period.includes('22')?' Â· Year 2':''}</div>
      <div class="milestone-title">${m.weight} Â· ${m.waist}</div>
      <div class="milestone-stats-row">
        <div class="milestone-stat">
          <div class="milestone-stat-val" style="font-size:11px">${m.cardio}</div>
          <div class="milestone-stat-lbl">Cardio</div>
        </div>
      </div>
      <div style="font-size:11px;color:var(--text2);margin-top:8px;line-height:1.4;font-style:italic">${m.look}</div>`;
    list.appendChild(el);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SETTINGS LISTENERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.getElementById('cal-target-row').addEventListener('click',()=>openSheet('cal-target-sheet'));
document.getElementById('plan-phase-row').addEventListener('click',()=>{
  renderPhaseOptionsInSheet();
  openSheet('phase-sheet');
});

// View Future Targets listener
document.getElementById('view-targets-row').addEventListener('click',()=>{
  renderTargetPhaseSelect();
  renderTargetPhasePreview(S.planPhase||1);
  openSheet('targets-sheet');
});
document.getElementById('target-phase-select').addEventListener('change',function(){
  renderTargetPhasePreview(parseInt(this.value));
});

// Calorie target preset select
document.getElementById('cal-preset-select').addEventListener('change',function(){
  const v=this.value;
  document.getElementById('cal-custom-fields').style.display=v==='custom'?'block':'none';
  if(v&&v!=='custom'){
    const [kcal,protein,carbs,fat]=v.split('|').map(Number);
    document.getElementById('ct-kcal').value=kcal;
    document.getElementById('ct-p').value=protein;
    document.getElementById('ct-c').value=carbs;
    document.getElementById('ct-f').value=fat;
    document.getElementById('cal-custom-fields').style.display='block';
  }
});

document.getElementById('cal-target-save').addEventListener('click',()=>{
  const kcal=parseInt(document.getElementById('ct-kcal').value)||S.calTarget?.kcal||2200;
  const protein=parseInt(document.getElementById('ct-p').value)||S.calTarget?.protein||140;
  const carbs=parseInt(document.getElementById('ct-c').value)||S.calTarget?.carbs||240;
  const fat=parseInt(document.getElementById('ct-f').value)||S.calTarget?.fat||60;
  S.calTarget={kcal,protein,carbs,fat};
  save();
  updateSettingsDisplay();
  renderPhaseTargetsCard();
  closeSheets();
  showToast('âœ… Calorie targets saved!');
});

// Init settings display on load
updateSettingsDisplay();
renderPhaseTargetsCard();
renderMilestones();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NEW SETTINGS FUNCTIONS â€” Roadmap + Phase Target Browser
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderRoadmapCard(){
  const card=document.getElementById('roadmap-card');
  if(!card)return;
  const curId=S.planPhase||1;
  card.innerHTML=PLAN_PHASES.map(ph=>{
    const isCur=ph.id===curId;
    const isPast=ph.id<curId;
    const dotColor=isPast?'var(--green)':isCur?ph.color:'var(--border2)';
    const nameColor=isCur?'var(--gold)':isPast?'var(--text2)':'var(--text)';
    return `<div class="roadmap-row" style="${isCur?'background:var(--gold-dim)':''}">
      <div class="roadmap-phase-dot" style="background:${dotColor};flex-shrink:0;width:10px;height:10px;border-radius:50%;margin-top:4px${isCur?';outline:2px solid '+ph.color+';outline-offset:2px':''}"></div>
      <div style="flex:1;min-width:0">
        <div style="display:flex;align-items:center;gap:6px;margin-bottom:1px">
          <div style="font-size:12px;font-weight:700;color:${nameColor}">Phase ${ph.id} â€” ${ph.name}</div>
          ${isCur?'<div style="font-size:8px;font-weight:700;color:var(--gold);letter-spacing:.8px;text-transform:uppercase;flex-shrink:0">YOU ARE HERE</div>':''}
          ${isPast?'<div style="font-size:10px;color:var(--green);flex-shrink:0">âœ“</div>':''}
        </div>
        <div style="font-size:10px;color:var(--text3);margin-bottom:1px">Y${ph.year} Â· Month ${ph.months} Â· ${ph.kcal.toLocaleString()} kcal</div>
        <div style="font-size:11px;color:var(--text2)">${ph.weight} Â· ${ph.waist} Â· ${ph.cardio}</div>
      </div>
    </div>`;
  }).join('');
}

function renderTargetPhaseSelect(){
  const sel=document.getElementById('target-phase-select');
  if(!sel)return;
  const curId=S.planPhase||1;
  sel.innerHTML=PLAN_PHASES.map(ph=>`
    <option value="${ph.id}" ${ph.id===curId?'selected':''}>
      Phase ${ph.id}: ${ph.name} Â· Y${ph.year} M${ph.months} Â· ${ph.kcal.toLocaleString()} kcal
    </option>`).join('');
}

function renderTargetPhasePreview(phaseId){
  const container=document.getElementById('target-phase-preview');
  if(!container)return;
  const ph=PLAN_PHASES.find(p=>p.id===phaseId)||PLAN_PHASES[0];
  const accentRgb=ph.year===2?'91,141,238':'232,197,71';
  container.innerHTML=`
    <div style="background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden">
      <div style="padding:12px 14px;border-bottom:1px solid var(--border);background:linear-gradient(90deg,rgba(${accentRgb},.12),transparent)">
        <div style="font-family:'Bebas Neue',cursive;font-size:20px;letter-spacing:1.5px;color:var(--text)">Phase ${ph.id} â€” ${ph.name}</div>
        <div style="font-size:11px;color:var(--text2);margin-top:2px">${ph.focus}</div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr">
        ${tCell('Calories',ph.kcal.toLocaleString(),'kcal')}
        ${tCell('Protein',ph.protein,'g')}
        ${tCell('Carbs',ph.carbs,'g')}
        ${tCell('Fat',ph.fat,'g')}
        ${tCell('Weight Target',ph.weight,'')}
        ${tCell('Waist Target',ph.waist,'')}
        ${tCellWide('Cardio Goal',ph.cardio)}
        ${tCellWide('Running Protocol',ph.running||'â€”')}
        ${tCellNote(ph.notes||'')}
      </div>
    </div>`;
}

function tCell(lbl,val,unit){
  return `<div style="padding:10px 14px;border-right:1px solid var(--border);border-bottom:1px solid var(--border)">
    <div style="font-size:9px;color:var(--text3);text-transform:uppercase;letter-spacing:.8px;font-weight:700">${lbl}</div>
    <div style="font-family:'DM Mono',monospace;font-size:14px;color:var(--text);margin-top:2px;font-weight:500">${val}<span style="font-size:10px;color:var(--text3)">${unit?(' '+unit):''}</span></div>
  </div>`;
}
function tCellWide(lbl,val){
  return `<div style="padding:10px 14px;grid-column:span 2;border-bottom:1px solid var(--border)">
    <div style="font-size:9px;color:var(--text3);text-transform:uppercase;letter-spacing:.8px;font-weight:700">${lbl}</div>
    <div style="font-size:12px;color:var(--text);margin-top:2px;line-height:1.4">${val}</div>
  </div>`;
}
function tCellNote(note){
  return `<div style="padding:10px 14px;grid-column:span 2">
    <div style="font-size:9px;color:var(--text3);text-transform:uppercase;letter-spacing:.8px;font-weight:700">Coach Note</div>
    <div style="font-size:11px;color:var(--text2);margin-top:4px;line-height:1.5;font-style:italic">${note}</div>
  </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
renderHome();
renderWorkout();
updateSettingsDisplay();
renderPhaseTargetsCard();
renderMilestones();
renderRoadmapCard();
setInterval(()=>{if(currentPage==='home')renderGymTime();},30000);
</script>
</body>
</html>
